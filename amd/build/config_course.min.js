define(["jquery","jqueryui","block_gradetracker/freezetable"],function(a,b,c){var d={};d.init=function(){d.bindings()},d.bindings=function(){a("#gt_stud_quals, #gt_staff_quals").parent().freezeTable({columnNum:2}),a(".gt_stud_units").each(function(){var b=a(this).parent(),c=a(this).attr("defaultCredits"),d=2;c>0&&d++,a(b).freezeTable({columnNum:d})}),a("#gt_switch_course").unbind("change"),a("#gt_switch_course").bind("change",function(){var b=a(this).attr("section"),c=a(this).val();return window.location=M.cfg.wwwroot+"/blocks/gradetracker/config.php?view=course&section="+b+"&id="+c}),a(".gt_tick_all").unbind("click"),a(".gt_tick_all").bind("click",function(b){var c=a(this).attr("tickType"),e=a(this).attr("qualID"),f=a(this).attr("unitID"),g=a(this).attr("userID"),h=a(this).attr("role"),i="",j=!1,k=a("#gt_unit_set_"+e).val();if("unit"===c&&"all"===h?(i=".gt_user_unit_unit_"+e+"_"+f+", ",i+=".gt_staff_unit_unit_"+e+"_"+f):"unit"===c&&void 0!==h?i=".gt_"+h+"_unit_unit_"+e+"_"+f:"user"===c&&void 0!==h&&void 0!==g?(i=".gt_"+h+"_unit_"+h+"_"+e+"_"+g,j=!0):"user"===c&&void 0!==h&&(i=".gt_"+h+"_unit_unit_"+e,j=!0),j&&k.length>0)a(i).prop("checked",!1),a(i).each(function(){var b=a(this).attr("uID");k.indexOf(b)>=0&&a(this).prop("checked",!0)});else{var l=a(i).prop("checked");a(i).prop("checked",!l)}d.updateCredits(e),b.preventDefault()}),a(".gt_user_unit_checkbox").unbind("change"),a(".gt_user_unit_checkbox").bind("change",function(){var b=a(this).attr("qID"),c=a(this).attr("sID");d.updateCredits(b,c)}),a(".gt_show_activity_section").unbind("click"),a(".gt_show_activity_section").bind("click",function(b){var c=a(this).attr("section"),d=a(this).attr("hide");a(this).parents("ul").find("a").removeClass("selected"),a(d).hide(),a(this).addClass("selected"),a(c).show(),b.preventDefault()}),a(".gt_activities_overview_criterion").unbind("click"),a(".gt_activities_overview_criterion").bind("click",function(){var b=a(this).attr("qID"),c=a(this).attr("uID"),d=a(this).attr("cID"),e=a("#gt_cid").val(),f={qualID:b,unitID:c,critID:d};a("#gt_activities_overview_loading").show(),a("#gt_activities_overview_details").hide(),a(".gt_activities_overview_details_row").remove(),a("#gt_activities_overview_details_qual").text(""),a("#gt_activities_overview_details_unit").text(""),a("#gt_activities_overview_details_criterion").text(""),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_activities_overview",params:f},function(b){var c=a.parseJSON(b);a("#gt_activities_overview_details_qual").text(c.qualification),a("#gt_activities_overview_details_unit").text(c.unit),a("#gt_activities_overview_details_criterion").text(c.criterion),a.each(c.links,function(b,c){var d="";d+="<tr class='gt_activities_overview_details_row'>",d+="<td><img class='gt_16' src='"+c.modicon+"' alt='"+c.modname+"' title='"+c.modname+"' /> <a href='"+M.cfg.wwwroot+"/blocks/gradetracker/config.php?view=course&id="+e+"&section=activities&page=add&cmid="+c.cmid+"'><b>"+c.name+"</b></a></td>",d+="<td>",a.each(c.criteria,function(a,b){d+=b.name+", "}),d+="</td>",d+="</tr>",a("div#gt_activities_overview_details table").append(d)}),a("#gt_activities_overview_loading").hide(),a("#gt_activities_overview_details").show()})}),GT.bind()},d.updateCredits=function(b,c){a("#gt_stud_units_"+b+" tr.user_qual_row").each(function(){var d=b,e=a(this).attr("sID");if(void 0===c||c==e){var f=0;a(this).find(".gt_user_unit_checkbox").each(function(){a(this).prop("checked")===!0&&(f+=parseInt(a(this).attr("credits")))}),a(".usr_credits_"+e+"_"+d).text(f);var g=parseInt(a("#gt_stud_units_"+d).attr("defaultCredits")),h=f>g?"gt_incorrect_credits":"";a(".usr_credits_"+e+"_"+d).parent().removeClass("gt_incorrect_credits"),a(".usr_credits_"+e+"_"+d).parent().addClass(h)}})};var e={};return e.log=function(a){console.log("[GT] "+(new Date).toTimeString().split(" ")[0]+": "+a)},e.init=function(){d.init(),e.log("Loaded config_course.js")},e});