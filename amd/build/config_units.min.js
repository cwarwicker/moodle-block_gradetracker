define(["jquery","jqueryui","block_gradetracker/scripts"],function(a,b,c){var d={};d.supportedCritTypes=[],d.cntCrit=0,d.cntNumericSubCriteria=0,d.cntNumericObservationCriteria=0,d.arrayOfNumericSubCriteria=[],d.arrayOfNumericObservationCriteria=[],d.maxNumericPoints=0,d.cntRangedRangeCriteria=0,d.cntRangedSubCriteria=0,d.critGradingStructures=[],d.critGradingTypes=[],d.init=function(b){d.cntCrit=a(".gt_unit_criteria_table_row").length,d.cntRangedRangeCriteria=a(".gt_criterion_range_row").length,d.cntRangedSubCriteria=a(".gt_criterion_range_criterion_row").length,a(".gt_numeric_observation").each(function(b,c){var e=a(this).attr("critNum");d.cntNumericObservationCriteria++,void 0===d.arrayOfNumericObservationCriteria[e]&&(d.arrayOfNumericObservationCriteria[e]=[]),d.arrayOfNumericObservationCriteria[e].push(d.cntNumericObservationCriteria)}),a(".gt_numeric_observation_criterion").each(function(b,c){var e=a(this).attr("critNum");d.cntNumericSubCriteria++,void 0===d.arrayOfNumericSubCriteria[e]&&(d.arrayOfNumericSubCriteria[e]=[]),d.arrayOfNumericSubCriteria[e].push(d.cntNumericSubCriteria)}),a.each(b.supportedTypes,function(a,b){d.supportedCritTypes.push({id:b.id,name:b.name})}),d.supportedCritTypes=d.supportedCritTypes.filter(function(a){return null!==a}),a.each(b.gradingStructures,function(a,b){d.critGradingStructures.push({id:b.id,name:b.name})}),a.each(b.gradingTypes,function(a,b){d.critGradingTypes.push(b)}),d.maxNumericPoints=b.maxNumericPoints,d.bindings(),d.applyCritNameBlurFocus()},d.bindings=function(){a(".gt_update_unit_criteria_letter").unbind("change"),a(".gt_update_unit_criteria_letter").bind("change",function(){var b=a(this).attr("letter"),c=a(this).val(),e=0;for(a(".critNameInput").each(function(){var f=a(this).val();if(null!==f.match("^"+b)&&(e++,e>c)){var g=a(a(this).parents("tr")[0]).attr("rownum");d.removeCriterion(g)}});e<c;)e++,d.addNewCriterion(b+e)}),a("#gt_load_unit_defaults").unbind("change"),a("#gt_load_unit_defaults").bind("change",function(){var b=a("#unit_type_id").val(),c=a(this).val();if(0==a("#unit_id").length){a("#gt_level_loading").show(),a('.gt_unit_element[type!="checkbox"]').val(""),a('.gt_unit_element[type="checkbox"]').prop("checked",!1);var d={structureID:b,levelID:c};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_unit_defaults",params:d},function(b){defaults=a.parseJSON(b),a.each(defaults,function(b,c){a("#gt_el_"+b).val(c),"checkbox"==a("#gt_el_"+b).prop("type")&&1==c&&a("#gt_el_"+b).prop("checked",!0)}),a("#gt_level_loading").hide()})}}),a("#gt_add_new_criterion").unbind("click"),a("#gt_add_new_criterion").bind("click",function(b){d.addNewCriterion(a(this).attr("critName")),b.preventDefault()}),a(".gt_remove_criterion").unbind("click"),a(".gt_remove_criterion").bind("click",function(b){d.removeCriterion(a(this).attr("critNum")),b.preventDefault()}),a(".gt_add_child_criterion").unbind("click"),a(".gt_add_child_criterion").bind("click",function(b){var c=a(this).attr("critNum");d.addNewCriterion();var e=d.cntCrit,f=a(".gt_criterion_row_"+e),g=a(".gt_criterion_row_"+c),h=a(".parent_criteria_select").filter(function(){return this.value==c}).length;h++;var i=a(g).find("td input.critNameInput").val();a(f).find("td input.critNameInput").val(i+"."+h);var j=a(g).find('select[name="unit_criteria['+c+'][type]"]').val();a(f).find('select[name="unit_criteria['+e+'][type]"]').val(j),a(f).find('select[name="unit_criteria['+e+'][parent]"]').val(c);var k=a(g).find('select[name="unit_criteria['+c+'][grading]"]').val();a(f).find('select[name="unit_criteria['+e+'][grading]"]').val(k);var l=a(g).find('select[name="unit_criteria['+c+'][gradingtype]"]').val();a(f).find('select[name="unit_criteria['+e+'][gradingtype]"]').val(l),b.preventDefault()}),a(".gt_duplicate_criterion").unbind("click"),a(".gt_duplicate_criterion").bind("click",function(b){var c=a(this).attr("critNum");d.addNewCriterion();var e=d.cntCrit,f=a(".gt_criterion_row_"+e),g=a(".gt_criterion_row_"+c),h=a(g).find('select[name="unit_criteria['+c+'][type]"]').val();a(f).find('select[name="unit_criteria['+e+'][type]"]').val(h);var i=a(g).find('select[name="unit_criteria['+c+'][parent]"]').val();a(f).find('select[name="unit_criteria['+e+'][parent]"]').val(i);var j=a(g).find('select[name="unit_criteria['+c+'][grading]"]').val();a(f).find('select[name="unit_criteria['+e+'][grading]"]').val(j);var k=a(g).find('select[name="unit_criteria['+c+'][gradingtype]"]').val();a(f).find('select[name="unit_criteria['+e+'][gradingtype]"]').val(k);var l=a(g).find('input[name="unit_criteria['+c+'][weight]"]').val();a(f).find('input[name="unit_criteria['+e+'][weight]"]').val(l),b.preventDefault()}),a(".gt_change_criterion_type").unbind("change"),a(".gt_change_criterion_type").bind("change",function(){var b=a(this).attr("critNum"),c=a(this).val(),e=a("#gt_crit_id_input_"+b),f=a(e).length>0?a(e).val():0,g=a("#gt_crit_grading_input_"+b),h=a(g).length>0?a(g).val():0,i="";a("#gt_criterion_options_cell_"+b).html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />');var j={critID:f,critType:c,num:b};if(GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_options",params:j},function(c){c=a.parseJSON(c),a(c).each(function(){i+="<label><small>"+this.label+"</small></label><br>",i+=this.element,i+="<br>"}),a("#gt_criterion_options_cell_"+b).html(i)}),0==a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row").length){var k="";k+='<tr class="gt_criterion_row_'+b+' gt_unit_criteria_table_sub_row">',k+="</tr>",a(".gt_criterion_row_"+b+".gt_unit_criteria_table_row").after(k)}a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row").html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />');var j={critID:f,critType:c,num:b,gradingID:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_sub_row",params:j},function(c){c=a.parseJSON(c),a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row").html(c),d.bindings()})}),a(".gt_add_range").unbind("click"),a(".gt_add_range").bind("click",function(b){d.cntRangedRangeCriteria++;var c=d.cntRangedRangeCriteria,e=a(this).attr("critNum"),f="";f+='<tr id="gt_criterion_range_'+e+"_"+c+'" class="gt_criterion_range_row" rangeNum="'+c+'">',f+='<td class="gt_range_info_cell">',f+="<table>",f+="<tr>",f+="<td>"+M.util.get_string("name","block_gradetracker")+"</td>",f+='<td><input type="text" name="unit_criteria['+e+"][ranges]["+c+'][name]" value="" placeholder="'+M.util.get_string("name","block_gradetracker")+'" /></td>',f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("details","block_gradetracker")+"</td>",f+='<td><textarea name="unit_criteria['+e+"][ranges]["+c+'][details]" placeholder="'+M.util.get_string("details","block_gradetracker")+'"></textarea></td>',f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("numobservations","block_gradetracker")+"</td>",f+='<td><input type="number" name="unit_criteria['+e+"][ranges]["+c+'][numobservations]" value="" /></td>',f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("gradestructure","block_gradetracker")+"</td>",f+="<td>",f+='<select name="unit_criteria['+e+"][ranges]["+c+'][gradingstructure]">',a.each(d.critGradingStructures,function(a,b){f+='<option value="'+b.id+'">'+b.name+"</option>"}),f+="</select>",f+="</td>",f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("criteria","block_gradetracker")+"</td>",f+='<td><a href="#" class="gt_add_range_criterion" critNum="'+e+'" rangeNum="'+c+'"><img src="'+M.util.image_url("t/add")+'" alt="add" class="gt_no_float" /></a></td>',f+="</tr>",f+="<tr>",f+='<td colspan="2"><a href="#" class="gt_remove_range" critNum="'+e+'" rangeNum="'+c+'"><img src="'+M.util.image_url("t/delete")+'" alt="delete" /></a></td>',f+="</tr>",f+="</table>",f+="</td>",f+='<td class="gt_range_criteria_cell">',f+="<table>",f+="<tr>",f+="<th>"+M.util.get_string("name","block_gradetracker")+"</th>",f+="<th>"+M.util.get_string("details","block_gradetracker")+"</th>",f+="<th>"+M.util.get_string("gradestructure","block_gradetracker")+"</th>",f+="<th></th>",f+="</tr>",f+="</table>",f+="</td>",f+="</tr>",a("#gt_criterion_sub_table_"+e).append(f),d.bindings(),b.preventDefault()}),a(".gt_remove_range").unbind("click"),a(".gt_remove_range").bind("click",function(b){var c=a(this).attr("critNum"),d=a(this).attr("rangeNum");a("#gt_criterion_range_"+c+"_"+d).remove(),b.preventDefault()}),a(".gt_add_range_criterion").unbind("click"),a(".gt_add_range_criterion").bind("click",function(b){d.cntRangedSubCriteria++;var c=d.cntRangedSubCriteria,e=a(this).attr("critNum"),f=a(this).attr("rangeNum"),g="";g+='<tr id="gt_range_criteria_row_'+e+"_"+f+"_"+c+'">',g+="<td>",g+='<input type="text" name="unit_criteria['+e+"][ranges]["+f+"][criteria]["+c+'][name]" />',g+="</td>",g+="<td>",g+='<textarea name="unit_criteria['+e+"][ranges]["+f+"][criteria]["+c+'][details]"></textarea>',g+="</td>",g+="<td>",g+='<select name="unit_criteria['+e+"][ranges]["+f+"][criteria]["+c+'][gradingstructure]">',g+='<option value=""></option>',a.each(d.critGradingStructures,function(a,b){var c=1===d.critGradingStructures.length?"selected":"";g+='<option value="'+b.id+'" '+c+" >"+b.name+"</option>"}),g+="</select>",g+="</td>",g+="<td>",g+='<a href="#" class="gt_remove_range_criterion" critNum="'+e+'" rangeNum="'+f+'" subCritNum="'+c+'"><img src="'+M.util.image_url("t/delete")+'" alt="delete" /></a>',g+="</td>",g+="</tr>",a("#gt_criterion_range_"+e+"_"+f+" td.gt_range_criteria_cell table").append(g),d.bindings(),b.preventDefault()}),a(".gt_remove_range_criterion").unbind("click"),a(".gt_remove_range_criterion").bind("click",function(b){var c=a(this).attr("critNum"),d=a(this).attr("rangeNum"),e=a(this).attr("subCritNum");a("#gt_range_criteria_row_"+c+"_"+d+"_"+e).remove(),b.preventDefault()}),a(".gt_add_numeric_observation").unbind("click"),a(".gt_add_numeric_observation").bind("click",function(b){var c=a(this).attr("critNum");d.cntNumericObservationCriteria++,void 0==d.arrayOfNumericObservationCriteria[c]&&(d.arrayOfNumericObservationCriteria[c]=new Array);var e=d.cntNumericObservationCriteria;d.arrayOfNumericObservationCriteria[c].push(e);var f="";f+='<td class="gt_criterion_observation_'+c+"_"+e+' gt_range_cell" obNum="'+e+'">',f+='<a href="#" class="gt_remove_numeric_observation" critNum="'+c+'" obNum="'+e+'"><img src="'+M.util.image_url("t/delete")+'" /></a>',f+='<input type="text" name="unit_criteria['+c+"][observation]["+e+'][name]" value="" placeholder="'+M.util.get_string("name","block_gradetracker")+'" /> &nbsp;&nbsp; ',f+="</td>",a("#gt_sub_observation_row_"+c).append(f),a("#gt_criterion_sub_table_"+c+" td.gt_sub_criteria_chart_cell").html(""),a("#gt_criterion_sub_table_"+c+" td.gt_sub_criterion_points_cell").html("");var f="";f+='<td class="gt_criterion_observation_'+c+"_"+e+" gt_observation_chart_cell gt_observation_chart_cell_"+e+'">',f+="</td>",a("#gt_sub_criteria_row_"+c).append(f),d.loadObservationConversionChart(c,e);var g=a(".gt_criterion_sub_criterion_row");a.each(g,function(){var b=a(this).attr("dNum");if(0==a(".gt_criterion_sub_criterion_row td.gt_criterion_observation_"+c+"_"+e+".gt_criterion_sub_criterion_"+c+"_"+b).length){var f="";f+='<td class="gt_observation_points_cell gt_criterion_observation_'+c+"_"+e+" gt_criterion_sub_criterion_"+c+"_"+b+'" cNum="'+b+'" obNum="'+e+'">',f+="</td>",a("#gt_criterion_sub_criterion_"+c+"_"+b).append(f)}d.refreshObservationSelectMenus(c)}),d.bindings(),b.preventDefault()}),a(".gt_remove_numeric_observation").unbind("click"),a(".gt_remove_numeric_observation").bind("click",function(b){var c=a(this).attr("critNum"),e=a(this).attr("obNum");a(".gt_criterion_observation_"+c+"_"+e).remove(),d.arrayOfNumericObservationCriteria[c]=a.grep(d.arrayOfNumericObservationCriteria[c],function(a,b){return a<e||a>e}),0==a("#gt_sub_observation_row_"+c+" td.gt_range_cell").length&&(d.refreshCriteriaSelectMenus(c),d.loadCriteriaConversionChart(c)),0==a("table#gt_criterion_sub_table_"+c+" tr.gt_criterion_sub_criterion_row").length&&a("table#gt_criterion_sub_table_"+c+" td.gt_sub_criteria_chart_cell").html(""),b.preventDefault()}),a(".gt_add_numeric_sub_criterion").unbind("click"),a(".gt_add_numeric_sub_criterion").bind("click",function(b){var c=a(this).attr("critNum");d.cntNumericSubCriteria++,void 0==d.arrayOfNumericSubCriteria[c]&&(d.arrayOfNumericSubCriteria[c]=new Array);var e=d.cntNumericSubCriteria;d.arrayOfNumericSubCriteria[c].push(e);var f="";if(f+='<tr id="gt_criterion_sub_criterion_'+c+"_"+e+'" class="gt_criterion_sub_criterion_row" dNum="'+e+'">',f+='<td class="gt_sub_criterion_name_cell">',f+='<a href="#" class="gt_remove_numeric_sub_criterion" critNum="'+c+'" subCritNum="'+e+'"><img src="'+M.util.image_url("t/delete")+'" /></a>',f+='<input type="text" name="unit_criteria['+c+"][subcriteria]["+e+'][name]" value="" placeholder="'+M.util.get_string("name","block_gradetracker")+'" /> &nbsp;&nbsp; ',f+="</td>",f+='<td class="gt_sub_criterion_points_cell">',f+="</td>",f+="</tr>",a("#gt_criterion_sub_table_"+c).append(f),0==a("#gt_sub_observation_row_"+c+" td.gt_range_cell").length)d.refreshCriteriaSelectMenus(c),a("#gt_criterion_sub_table_"+c+" td.gt_sub_criteria_chart_cell:empty").length>0&&d.loadCriteriaConversionChart(c);else{var g=a("#gt_sub_observation_row_"+c+" td.gt_range_cell");a.each(g,function(){var b=a(this).attr("obNum"),e=a(".gt_criterion_sub_criterion_row");a.each(e,function(){var e=a(this).attr("dNum");if(0==a(".gt_criterion_sub_criterion_row td.gt_criterion_observation_"+c+"_"+b+".gt_criterion_sub_criterion_"+c+"_"+e).length){var f="";f+='<td class="gt_observation_points_cell gt_criterion_observation_'+c+"_"+b+" gt_criterion_sub_criterion_"+c+"_"+e+'" cNum="'+e+'" obNum="'+b+'">',f+="</td>",a("#gt_criterion_sub_criterion_"+c+"_"+e).append(f)}d.refreshObservationSelectMenus(c)})})}d.bindings(),b.preventDefault()}),a(".gt_remove_numeric_sub_criterion").unbind("click"),a(".gt_remove_numeric_sub_criterion").bind("click",function(b){var c=a(this).attr("critNum"),e=a(this).attr("subCritNum");a("#gt_criterion_sub_criterion_"+c+"_"+e).remove(),d.arrayOfNumericSubCriteria[c]=a.grep(d.arrayOfNumericSubCriteria[c],function(a,b){return a<e||a>e}),0==a("table#gt_criterion_sub_table_"+c+" tr.gt_criterion_sub_criterion_row").length&&a("table#gt_criterion_sub_table_"+c+" td.gt_sub_criteria_chart_cell").html(""),b.preventDefault()}),a(".gt_change_criterion_grading_structure").unbind("change"),a(".gt_change_criterion_grading_structure").bind("change",function(){var b=a(this).attr("critNum");if(a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row table.gt_criteria_conversion_chart").length>0)if(a("#gt_sub_observation_row_"+b+" td.gt_range_cell").length>0){var c=a("#gt_sub_observation_row_"+b+" td.gt_range_cell");a.each(c,function(){var c=a(this).attr("obNum");d.loadObservationConversionChart(b,c)})}else d.loadCriteriaConversionChart(b)}),GT.bind()},d.addNewCriterion=function(b){var c="";void 0===b&&(b=""),d.cntCrit++;var e=d.cntCrit;c+="<tr class='gt_criterion_row_"+e+" gt_unit_criteria_table_row' rowNum='"+e+"'>",c+="<td><input type='text' placeholder='C"+e+"' name='unit_criteria["+e+"][name]' class='critNameInput' value='"+b+"' /></td>",c+="<td>",c+="<select name='unit_criteria["+e+"][type]' class='gt_change_criterion_type' critNum='"+e+"'>",a.each(d.supportedCritTypes,function(a,b){c+="<option value='"+b.id+"'>"+b.name+"</option>"}),c+="</select>",c+="</td>",c+="<td id='gt_criterion_options_cell_"+e+"' class='gt_criterion_options_cell'>",c+="</td>",c+="<td><textarea name='unit_criteria["+e+"][details]'></textarea></td>",c+="<td><input type='number' min='0' step='any' placeholder='1.0' name='unit_criteria["+e+"][weight]' value='1.0' /></td>",c+="<td>",c+="<select name='unit_criteria["+e+"][parent]' class='parent_criteria_select'>",c+="<option value=''>"+M.util.get_string("na","block_gradetracker")+"</option>",c+="</select>&nbsp;&nbsp;",c+="<a href='#' class='gt_add_child_criterion' critNum='"+e+"'><img src='"+M.cfg.wwwroot+"/blocks/gradetracker/pix/icons/node.png' class='gt_16' alt='"+M.util.get_string("addchildcrit","block_gradetracker")+"' title='"+M.util.get_string("addchildcrit","block_gradetracker")+"' /></a>",c+="</td>",c+="<td>",c+="<select name='unit_criteria["+e+"][grading]' id='gt_crit_grading_input_"+e+"' class='gt_change_criterion_grading_structure' critNum='"+e+"'>",1==d.critGradingStructures.length?(soloGradingStructure=d.critGradingStructures[0],c+="<option value='"+soloGradingStructure.id+"'>"+soloGradingStructure.name+"</option>"):(c+="<option value=''></option>",a.each(d.critGradingStructures,function(){c+="<option value='"+this.id+"'>"+this.name+"</option>"})),c+="</select>",c+="</td>",c+="<td>",c+="<select name='unit_criteria["+e+"][gradingtype]'>",a.each(d.critGradingTypes,function(a,b){c+="<option value='"+b+"'>"+b+"</option>"}),c+="</select>",c+="</td>",c+="<td>",c+="<a href='#' class='gt_duplicate_criterion' critNum='"+e+"'>",c+="<img src='"+M.util.image_url("t/copy")+"' alt='copy' />",c+="</a>",c+="</td>",c+="<td>",c+="<a href='#' class='gt_remove_criterion' critNum='"+e+"'>",c+="<img src='"+M.util.image_url("t/delete")+"' alt='delete' />",c+="</a>",c+="</td>",c+="</tr>",a("#gt_unit_criteria").append(c),d.refreshParentCriteriaLists(),d.applyCritNameBlurFocus(),d.bindings()},d.removeCriterion=function(b){a(".gt_criterion_row_"+b).remove(),d.refreshParentCriteriaLists()},d.loadObservationConversionChart=function(b,c){a("#gt_criterion_sub_table_"+b+" td.gt_observation_chart_cell_"+c).html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />'),d.loadConversionChart(b,"[charts]["+c+"]",a("#gt_criterion_sub_table_"+b+" td.gt_observation_chart_cell_"+c))},d.loadCriteriaConversionChart=function(b){a("#gt_criterion_sub_table_"+b+" td.gt_sub_criteria_chart_cell").html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />'),d.loadConversionChart(b,"[chart]",a("#gt_criterion_sub_table_"+b+" td.gt_sub_criteria_chart_cell"))},d.loadConversionChart=function(b,c,d){var e=a('select[name="unit_criteria['+b+'][grading]"]').val(),f={gradingStructureID:e},g="";return GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_met_values",params:f},function(e){var f=1;e&&(e=a.parseJSON(e),f=e.length),g+='<table class="gt_criteria_conversion_chart">',g+="<tr>",g+='<th colspan="'+f+'">'+M.util.get_string("conversionchart","block_gradetracker")+"</th>",g+="</tr>",g+="<tr>",e&&a.each(e,function(){g+='<th title="'+this.fullname+'">'+this.name+"</th>"}),g+="</tr>",g+="<tr>",e&&a.each(e,function(){g+='<td><input type="text" name="unit_criteria['+b+"]"+c+"["+this.id+']" value="" /></td>'}),g+="</tr>",g+="</table>",d.html(g)}),g},d.refreshObservationSelectMenus=function(b){var c=a("#gt_criterion_sub_table_"+b+" td.gt_observation_points_cell:empty");a.each(c,function(){var c=a(this).parent().attr("dNum"),e=a(this).attr("obNum"),f="";f+='<select name="unit_criteria['+b+"][points]["+c+"|"+e+']">';for(var g=0;g<=d.maxNumericPoints;g++)f+='<option value="'+g+'">'+g+"</option>";f+="</select>",a(this).html(f)})},d.refreshCriteriaSelectMenus=function(b){var c=a("#gt_criterion_sub_table_"+b+" td.gt_sub_criterion_points_cell:empty");a.each(c,function(){var c=a(this).parent().attr("dNum"),e="";e+='<select name="unit_criteria['+b+"][subcriteria]["+c+'][points]">';for(var f=0;f<=d.maxNumericPoints;f++)e+='<option value="'+f+'">'+f+"</option>";e+="</select>",a(this).html(e)})},d.refreshParentCriteriaLists=function(){var b=new Array;a(".critNameInput").each(function(){var c=a(this).parents("tr"),d=a(c).attr("rowNum");b.push({row:d,name:a(this).val()})}),a(".parent_criteria_select").each(function(){var c=!1,d=a(this).val();a(this).html("");var e=a(this);a(e).append('<option value="">N/A</option>'),a.each(b,function(){a(e).append('<option value="'+this.row+'">'+this.name+"</option>"),d===this.row&&(c=!0)}),c&&a(e).val(d)})},d.applyCritNameBlurFocus=function(){var b=a(".critNameInput");if(b.length>0){var c=a(".parent_criteria_select");c.length>0&&(a(".critNameInput").off("focus"),a(".critNameInput").on("focus",function(){critNameSwitchThis=a(this).parents("tr").attr("rowNum")}),a(".critNameInput").off("blur"),a(".critNameInput").on("blur",function(){var b=a(this).val();b=b.replace(/[^0-9a-z- \._ \/]/gi,""),a(this).val(b),a.each(c,function(){var c=a(this).children();a.each(c,function(c,d){a(d).val()==critNameSwitchThis&&a(d).text(b)})}),critNameSwitchThis=null}))}},window.config_units=d;var e={};return e.log=function(a){console.log("[GT] "+(new Date).toTimeString().split(" ")[0]+": "+a)},e.init=function(a){d.init(a),e.log("Loaded config_units.js")},e});