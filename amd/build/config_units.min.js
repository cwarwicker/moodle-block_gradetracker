define(["jquery","jqueryui"],function(a,b){var c={};c.supportedCritTypes=[],c.cntCrit=0,c.cntNumericSubCriteria=0,c.cntNumericObservationCriteria=0,c.arrayOfNumericSubCriteria=[],c.arrayOfNumericObservationCriteria=[],c.maxNumericPoints=0,c.cntRangedRangeCriteria=0,c.cntRangedSubCriteria=0,c.critGradingStructures=[],c.critGradingTypes=[],c.init=function(b){c.cntCrit=a(".gt_unit_criteria_table_row").length,c.cntRangedRangeCriteria=a(".gt_criterion_range_row").length,c.cntRangedSubCriteria=a(".gt_criterion_range_criterion_row").length,a(".gt_numeric_observation").each(function(b,d){var e=a(this).attr("critNum");c.cntNumericObservationCriteria++,void 0===c.arrayOfNumericObservationCriteria[e]&&(c.arrayOfNumericObservationCriteria[e]=[]),c.arrayOfNumericObservationCriteria[e].push(c.cntNumericObservationCriteria)}),a(".gt_numeric_observation_criterion").each(function(b,d){var e=a(this).attr("critNum");c.cntNumericSubCriteria++,void 0===c.arrayOfNumericSubCriteria[e]&&(c.arrayOfNumericSubCriteria[e]=[]),c.arrayOfNumericSubCriteria[e].push(c.cntNumericSubCriteria)}),a.each(b.supportedTypes,function(a,b){c.supportedCritTypes.push({id:b.id,name:b.name})}),c.supportedCritTypes=c.supportedCritTypes.filter(function(a){return null!==a}),a.each(b.gradingStructures,function(a,b){c.critGradingStructures.push({id:b.id,name:b.name})}),a.each(b.gradingTypes,function(a,b){c.critGradingTypes.push(b)}),c.maxNumericPoints=b.maxNumericPoints,c.bindings(),c.applyCritNameBlurFocus()},c.bindings=function(){a(".gt_update_unit_criteria_letter").unbind("change"),a(".gt_update_unit_criteria_letter").bind("change",function(){var b=a(this).attr("letter"),d=a(this).val(),e=0;for(a(".critNameInput").each(function(){var f=a(this).val();if(null!==f.match("^"+b)&&(e++,e>d)){var g=a(a(this).parents("tr")[0]).attr("rownum");c.removeCriterion(g)}});e<d;)e++,c.addNewCriterion(b+e)}),a("#gt_load_unit_defaults").unbind("change"),a("#gt_load_unit_defaults").bind("change",function(){var b=a("#unit_type_id").val(),c=a(this).val();if(0==a("#unit_id").length){a("#gt_level_loading").show(),a('.gt_unit_element[type!="checkbox"]').val(""),a('.gt_unit_element[type="checkbox"]').prop("checked",!1);var d={structureID:b,levelID:c};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_unit_defaults",params:d},function(b){defaults=a.parseJSON(b),a.each(defaults,function(b,c){a("#gt_el_"+b).val(c),"checkbox"==a("#gt_el_"+b).prop("type")&&1==c&&a("#gt_el_"+b).prop("checked",!0)}),a("#gt_level_loading").hide()})}}),a("#gt_add_new_criterion").unbind("click"),a("#gt_add_new_criterion").bind("click",function(b){c.addNewCriterion(a(this).attr("critName")),b.preventDefault()}),a(".gt_remove_criterion").unbind("click"),a(".gt_remove_criterion").bind("click",function(b){c.removeCriterion(a(this).attr("critNum")),b.preventDefault()}),a(".gt_add_child_criterion").unbind("click"),a(".gt_add_child_criterion").bind("click",function(b){var d=a(this).attr("critNum");c.addNewCriterion();var e=c.cntCrit,f=a(".gt_criterion_row_"+e),g=a(".gt_criterion_row_"+d),h=a(".parent_criteria_select").filter(function(){return this.value==d}).length;h++;var i=a(g).find("td input.critNameInput").val();a(f).find("td input.critNameInput").val(i+"."+h);var j=a(g).find('select[name="unit_criteria['+d+'][type]"]').val();a(f).find('select[name="unit_criteria['+e+'][type]"]').val(j),a(f).find('select[name="unit_criteria['+e+'][parent]"]').val(d);var k=a(g).find('select[name="unit_criteria['+d+'][grading]"]').val();a(f).find('select[name="unit_criteria['+e+'][grading]"]').val(k);var l=a(g).find('select[name="unit_criteria['+d+'][gradingtype]"]').val();a(f).find('select[name="unit_criteria['+e+'][gradingtype]"]').val(l),b.preventDefault()}),a(".gt_duplicate_criterion").unbind("click"),a(".gt_duplicate_criterion").bind("click",function(b){var d=a(this).attr("critNum");c.addNewCriterion();var e=c.cntCrit,f=a(".gt_criterion_row_"+e),g=a(".gt_criterion_row_"+d),h=a(g).find('select[name="unit_criteria['+d+'][type]"]').val();a(f).find('select[name="unit_criteria['+e+'][type]"]').val(h);var i=a(g).find('select[name="unit_criteria['+d+'][parent]"]').val();a(f).find('select[name="unit_criteria['+e+'][parent]"]').val(i);var j=a(g).find('select[name="unit_criteria['+d+'][grading]"]').val();a(f).find('select[name="unit_criteria['+e+'][grading]"]').val(j);var k=a(g).find('select[name="unit_criteria['+d+'][gradingtype]"]').val();a(f).find('select[name="unit_criteria['+e+'][gradingtype]"]').val(k);var l=a(g).find('input[name="unit_criteria['+d+'][weight]"]').val();a(f).find('input[name="unit_criteria['+e+'][weight]"]').val(l),b.preventDefault()}),a(".gt_change_criterion_type").unbind("change"),a(".gt_change_criterion_type").bind("change",function(){var b=a(this).attr("critNum"),d=a(this).val(),e=a("#gt_crit_id_input_"+b),f=a(e).length>0?a(e).val():0,g=a("#gt_crit_grading_input_"+b),h=a(g).length>0?a(g).val():0,i="";a("#gt_criterion_options_cell_"+b).html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />');var j={critID:f,critType:d,num:b};if(GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_options",params:j},function(c){c=a.parseJSON(c),a(c).each(function(){i+="<label><small>"+this.label+"</small></label><br>",i+=this.element,i+="<br>"}),a("#gt_criterion_options_cell_"+b).html(i)}),0==a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row").length){var k="";k+='<tr class="gt_criterion_row_'+b+' gt_unit_criteria_table_sub_row">',k+="</tr>",a(".gt_criterion_row_"+b+".gt_unit_criteria_table_row").after(k)}a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row").html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />');var j={critID:f,critType:d,num:b,gradingID:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_sub_row",params:j},function(d){d=a.parseJSON(d),a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row").html(d),c.bindings()})}),a(".gt_add_range").unbind("click"),a(".gt_add_range").bind("click",function(b){c.cntRangedRangeCriteria++;var d=c.cntRangedRangeCriteria,e=a(this).attr("critNum"),f="";f+='<tr id="gt_criterion_range_'+e+"_"+d+'" class="gt_criterion_range_row" rangeNum="'+d+'">',f+='<td class="gt_range_info_cell">',f+="<table>",f+="<tr>",f+="<td>"+M.util.get_string("name","block_gradetracker")+"</td>",f+='<td><input type="text" name="unit_criteria['+e+"][ranges]["+d+'][name]" value="" placeholder="'+M.util.get_string("name","block_gradetracker")+'" /></td>',f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("details","block_gradetracker")+"</td>",f+='<td><textarea name="unit_criteria['+e+"][ranges]["+d+'][details]" placeholder="'+M.util.get_string("details","block_gradetracker")+'"></textarea></td>',f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("numobservations","block_gradetracker")+"</td>",f+='<td><input type="number" name="unit_criteria['+e+"][ranges]["+d+'][numobservations]" value="" /></td>',f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("gradestructure","block_gradetracker")+"</td>",f+="<td>",f+='<select name="unit_criteria['+e+"][ranges]["+d+'][gradingstructure]">',a.each(c.critGradingStructures,function(a,b){f+='<option value="'+b.id+'">'+b.name+"</option>"}),f+="</select>",f+="</td>",f+="</tr>",f+="<tr>",f+="<td>"+M.util.get_string("criteria","block_gradetracker")+"</td>",f+='<td><a href="#" class="gt_add_range_criterion" critNum="'+e+'" rangeNum="'+d+'"><img src="'+M.util.image_url("t/add")+'" alt="add" class="gt_no_float" /></a></td>',f+="</tr>",f+="<tr>",f+='<td colspan="2"><a href="#" class="gt_remove_range" critNum="'+e+'" rangeNum="'+d+'"><img src="'+M.util.image_url("t/delete")+'" alt="delete" /></a></td>',f+="</tr>",f+="</table>",f+="</td>",f+='<td class="gt_range_criteria_cell">',f+="<table>",f+="<tr>",f+="<th>"+M.util.get_string("name","block_gradetracker")+"</th>",f+="<th>"+M.util.get_string("details","block_gradetracker")+"</th>",f+="<th>"+M.util.get_string("gradestructure","block_gradetracker")+"</th>",f+="<th></th>",f+="</tr>",f+="</table>",f+="</td>",f+="</tr>",a("#gt_criterion_sub_table_"+e).append(f),c.bindings(),b.preventDefault()}),a(".gt_remove_range").unbind("click"),a(".gt_remove_range").bind("click",function(b){var c=a(this).attr("critNum"),d=a(this).attr("rangeNum");a("#gt_criterion_range_"+c+"_"+d).remove(),b.preventDefault()}),a(".gt_add_range_criterion").unbind("click"),a(".gt_add_range_criterion").bind("click",function(b){c.cntRangedSubCriteria++;var d=c.cntRangedSubCriteria,e=a(this).attr("critNum"),f=a(this).attr("rangeNum"),g="";g+='<tr id="gt_range_criteria_row_'+e+"_"+f+"_"+d+'">',g+="<td>",g+='<input type="text" name="unit_criteria['+e+"][ranges]["+f+"][criteria]["+d+'][name]" />',g+="</td>",g+="<td>",g+='<textarea name="unit_criteria['+e+"][ranges]["+f+"][criteria]["+d+'][details]"></textarea>',g+="</td>",g+="<td>",g+='<select name="unit_criteria['+e+"][ranges]["+f+"][criteria]["+d+'][gradingstructure]">',g+='<option value=""></option>',a.each(c.critGradingStructures,function(a,b){var d=1===c.critGradingStructures.length?"selected":"";g+='<option value="'+b.id+'" '+d+" >"+b.name+"</option>"}),g+="</select>",g+="</td>",g+="<td>",g+='<a href="#" class="gt_remove_range_criterion" critNum="'+e+'" rangeNum="'+f+'" subCritNum="'+d+'"><img src="'+M.util.image_url("t/delete")+'" alt="delete" /></a>',g+="</td>",g+="</tr>",a("#gt_criterion_range_"+e+"_"+f+" td.gt_range_criteria_cell table").append(g),c.bindings(),b.preventDefault()}),a(".gt_remove_range_criterion").unbind("click"),a(".gt_remove_range_criterion").bind("click",function(b){var c=a(this).attr("critNum"),d=a(this).attr("rangeNum"),e=a(this).attr("subCritNum");a("#gt_range_criteria_row_"+c+"_"+d+"_"+e).remove(),b.preventDefault()}),a(".gt_add_numeric_observation").unbind("click"),a(".gt_add_numeric_observation").bind("click",function(b){var d=a(this).attr("critNum");c.cntNumericObservationCriteria++,void 0==c.arrayOfNumericObservationCriteria[d]&&(c.arrayOfNumericObservationCriteria[d]=new Array);var e=c.cntNumericObservationCriteria;c.arrayOfNumericObservationCriteria[d].push(e);var f="";f+='<td class="gt_criterion_observation_'+d+"_"+e+' gt_range_cell" obNum="'+e+'">',f+='<a href="#" class="gt_remove_numeric_observation" critNum="'+d+'" obNum="'+e+'"><img src="'+M.util.image_url("t/delete")+'" /></a>',f+='<input type="text" name="unit_criteria['+d+"][observation]["+e+'][name]" value="" placeholder="'+M.util.get_string("name","block_gradetracker")+'" /> &nbsp;&nbsp; ',f+="</td>",a("#gt_sub_observation_row_"+d).append(f),a("#gt_criterion_sub_table_"+d+" td.gt_sub_criteria_chart_cell").html(""),a("#gt_criterion_sub_table_"+d+" td.gt_sub_criterion_points_cell").html("");var f="";f+='<td class="gt_criterion_observation_'+d+"_"+e+" gt_observation_chart_cell gt_observation_chart_cell_"+e+'">',f+="</td>",a("#gt_sub_criteria_row_"+d).append(f),c.loadObservationConversionChart(d,e);var g=a(".gt_criterion_sub_criterion_row");a.each(g,function(){var b=a(this).attr("dNum");if(0==a(".gt_criterion_sub_criterion_row td.gt_criterion_observation_"+d+"_"+e+".gt_criterion_sub_criterion_"+d+"_"+b).length){var f="";f+='<td class="gt_observation_points_cell gt_criterion_observation_'+d+"_"+e+" gt_criterion_sub_criterion_"+d+"_"+b+'" cNum="'+b+'" obNum="'+e+'">',f+="</td>",a("#gt_criterion_sub_criterion_"+d+"_"+b).append(f)}c.refreshObservationSelectMenus(d)}),c.bindings(),b.preventDefault()}),a(".gt_remove_numeric_observation").unbind("click"),a(".gt_remove_numeric_observation").bind("click",function(b){var d=a(this).attr("critNum"),e=a(this).attr("obNum");a(".gt_criterion_observation_"+d+"_"+e).remove(),c.arrayOfNumericObservationCriteria[d]=a.grep(c.arrayOfNumericObservationCriteria[d],function(a,b){return a<e||a>e}),0==a("#gt_sub_observation_row_"+d+" td.gt_range_cell").length&&(c.refreshCriteriaSelectMenus(d),c.loadCriteriaConversionChart(d)),0==a("table#gt_criterion_sub_table_"+d+" tr.gt_criterion_sub_criterion_row").length&&a("table#gt_criterion_sub_table_"+d+" td.gt_sub_criteria_chart_cell").html(""),b.preventDefault()}),a(".gt_add_numeric_sub_criterion").unbind("click"),a(".gt_add_numeric_sub_criterion").bind("click",function(b){var d=a(this).attr("critNum");c.cntNumericSubCriteria++,void 0==c.arrayOfNumericSubCriteria[d]&&(c.arrayOfNumericSubCriteria[d]=new Array);var e=c.cntNumericSubCriteria;c.arrayOfNumericSubCriteria[d].push(e);var f="";if(f+='<tr id="gt_criterion_sub_criterion_'+d+"_"+e+'" class="gt_criterion_sub_criterion_row" dNum="'+e+'">',f+='<td class="gt_sub_criterion_name_cell">',f+='<a href="#" class="gt_remove_numeric_sub_criterion" critNum="'+d+'" subCritNum="'+e+'"><img src="'+M.util.image_url("t/delete")+'" /></a>',f+='<input type="text" name="unit_criteria['+d+"][subcriteria]["+e+'][name]" value="" placeholder="'+M.util.get_string("name","block_gradetracker")+'" /> &nbsp;&nbsp; ',f+="</td>",f+='<td class="gt_sub_criterion_points_cell">',f+="</td>",f+="</tr>",a("#gt_criterion_sub_table_"+d).append(f),0==a("#gt_sub_observation_row_"+d+" td.gt_range_cell").length)c.refreshCriteriaSelectMenus(d),a("#gt_criterion_sub_table_"+d+" td.gt_sub_criteria_chart_cell:empty").length>0&&c.loadCriteriaConversionChart(d);else{var g=a("#gt_sub_observation_row_"+d+" td.gt_range_cell");a.each(g,function(){var b=a(this).attr("obNum"),e=a(".gt_criterion_sub_criterion_row");a.each(e,function(){var e=a(this).attr("dNum");if(0==a(".gt_criterion_sub_criterion_row td.gt_criterion_observation_"+d+"_"+b+".gt_criterion_sub_criterion_"+d+"_"+e).length){var f="";f+='<td class="gt_observation_points_cell gt_criterion_observation_'+d+"_"+b+" gt_criterion_sub_criterion_"+d+"_"+e+'" cNum="'+e+'" obNum="'+b+'">',f+="</td>",a("#gt_criterion_sub_criterion_"+d+"_"+e).append(f)}c.refreshObservationSelectMenus(d)})})}c.bindings(),b.preventDefault()}),a(".gt_remove_numeric_sub_criterion").unbind("click"),a(".gt_remove_numeric_sub_criterion").bind("click",function(b){var d=a(this).attr("critNum"),e=a(this).attr("subCritNum");a("#gt_criterion_sub_criterion_"+d+"_"+e).remove(),c.arrayOfNumericSubCriteria[d]=a.grep(c.arrayOfNumericSubCriteria[d],function(a,b){return a<e||a>e}),0==a("table#gt_criterion_sub_table_"+d+" tr.gt_criterion_sub_criterion_row").length&&a("table#gt_criterion_sub_table_"+d+" td.gt_sub_criteria_chart_cell").html(""),b.preventDefault()}),a(".gt_change_criterion_grading_structure").unbind("change"),a(".gt_change_criterion_grading_structure").bind("change",function(){var b=a(this).attr("critNum");if(a(".gt_criterion_row_"+b+".gt_unit_criteria_table_sub_row table.gt_criteria_conversion_chart").length>0)if(a("#gt_sub_observation_row_"+b+" td.gt_range_cell").length>0){var d=a("#gt_sub_observation_row_"+b+" td.gt_range_cell");a.each(d,function(){var d=a(this).attr("obNum");c.loadObservationConversionChart(b,d)})}else c.loadCriteriaConversionChart(b)}),GT.bind()},c.addNewCriterion=function(b){var d="";void 0===b&&(b=""),c.cntCrit++;var e=c.cntCrit;d+="<tr class='gt_criterion_row_"+e+" gt_unit_criteria_table_row' rowNum='"+e+"'>",d+="<td><input type='text' placeholder='C"+e+"' name='unit_criteria["+e+"][name]' class='critNameInput' value='"+b+"' /></td>",d+="<td>",d+="<select name='unit_criteria["+e+"][type]' class='gt_change_criterion_type' critNum='"+e+"'>",a.each(c.supportedCritTypes,function(a,b){d+="<option value='"+b.id+"'>"+b.name+"</option>"}),d+="</select>",d+="</td>",d+="<td id='gt_criterion_options_cell_"+e+"' class='gt_criterion_options_cell'>",d+="</td>",d+="<td><textarea name='unit_criteria["+e+"][details]'></textarea></td>",d+="<td><input type='number' min='0' step='any' placeholder='1.0' name='unit_criteria["+e+"][weight]' value='1.0' /></td>",d+="<td>",d+="<select name='unit_criteria["+e+"][parent]' class='parent_criteria_select'>",d+="<option value=''>"+M.util.get_string("na","block_gradetracker")+"</option>",d+="</select>&nbsp;&nbsp;",d+="<a href='#' class='gt_add_child_criterion' critNum='"+e+"'><img src='"+M.cfg.wwwroot+"/blocks/gradetracker/pix/icons/node.png' class='gt_16' alt='"+M.util.get_string("addchildcrit","block_gradetracker")+"' title='"+M.util.get_string("addchildcrit","block_gradetracker")+"' /></a>",d+="</td>",d+="<td>",d+="<select name='unit_criteria["+e+"][grading]' id='gt_crit_grading_input_"+e+"' class='gt_change_criterion_grading_structure' critNum='"+e+"'>",1==c.critGradingStructures.length?(soloGradingStructure=c.critGradingStructures[0],d+="<option value='"+soloGradingStructure.id+"'>"+soloGradingStructure.name+"</option>"):(d+="<option value=''></option>",a.each(c.critGradingStructures,function(){d+="<option value='"+this.id+"'>"+this.name+"</option>"})),d+="</select>",d+="</td>",d+="<td>",d+="<select name='unit_criteria["+e+"][gradingtype]'>",a.each(c.critGradingTypes,function(a,b){d+="<option value='"+b+"'>"+b+"</option>"}),d+="</select>",d+="</td>",d+="<td>",d+="<a href='#' class='gt_duplicate_criterion' critNum='"+e+"'>",d+="<img src='"+M.util.image_url("t/copy")+"' alt='copy' />",d+="</a>",d+="</td>",d+="<td>",d+="<a href='#' class='gt_remove_criterion' critNum='"+e+"'>",d+="<img src='"+M.util.image_url("t/delete")+"' alt='delete' />",d+="</a>",d+="</td>",d+="</tr>",a("#gt_unit_criteria").append(d),c.refreshParentCriteriaLists(),c.applyCritNameBlurFocus(),c.bindings()},c.removeCriterion=function(b){a(".gt_criterion_row_"+b).remove(),c.refreshParentCriteriaLists()},c.loadObservationConversionChart=function(b,d){a("#gt_criterion_sub_table_"+b+" td.gt_observation_chart_cell_"+d).html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />'),c.loadConversionChart(b,"[charts]["+d+"]",a("#gt_criterion_sub_table_"+b+" td.gt_observation_chart_cell_"+d))},c.loadCriteriaConversionChart=function(b){a("#gt_criterion_sub_table_"+b+" td.gt_sub_criteria_chart_cell").html('<img src="'+M.util.image_url("i/loading_small")+'" alt="loading" />'),c.loadConversionChart(b,"[chart]",a("#gt_criterion_sub_table_"+b+" td.gt_sub_criteria_chart_cell"))},c.loadConversionChart=function(b,c,d){var e=a('select[name="unit_criteria['+b+'][grading]"]').val(),f={gradingStructureID:e},g="";return GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_met_values",params:f},function(e){var f=1;e&&(e=a.parseJSON(e),f=e.length),g+='<table class="gt_criteria_conversion_chart">',g+="<tr>",g+='<th colspan="'+f+'">'+M.util.get_string("conversionchart","block_gradetracker")+"</th>",g+="</tr>",g+="<tr>",e&&a.each(e,function(){g+='<th title="'+this.fullname+'">'+this.name+"</th>"}),g+="</tr>",g+="<tr>",e&&a.each(e,function(){g+='<td><input type="text" name="unit_criteria['+b+"]"+c+"["+this.id+']" value="" /></td>'}),g+="</tr>",g+="</table>",d.html(g)}),g},c.refreshObservationSelectMenus=function(b){var d=a("#gt_criterion_sub_table_"+b+" td.gt_observation_points_cell:empty");a.each(d,function(){var d=a(this).parent().attr("dNum"),e=a(this).attr("obNum"),f="";f+='<select name="unit_criteria['+b+"][points]["+d+"|"+e+']">';for(var g=0;g<=c.maxNumericPoints;g++)f+='<option value="'+g+'">'+g+"</option>";f+="</select>",a(this).html(f)})},c.refreshCriteriaSelectMenus=function(b){var d=a("#gt_criterion_sub_table_"+b+" td.gt_sub_criterion_points_cell:empty");a.each(d,function(){var d=a(this).parent().attr("dNum"),e="";e+='<select name="unit_criteria['+b+"][subcriteria]["+d+'][points]">';for(var f=0;f<=c.maxNumericPoints;f++)e+='<option value="'+f+'">'+f+"</option>";e+="</select>",a(this).html(e)})},c.refreshParentCriteriaLists=function(){var b=new Array;a(".critNameInput").each(function(){var c=a(this).parents("tr"),d=a(c).attr("rowNum");b.push({row:d,name:a(this).val()})}),a(".parent_criteria_select").each(function(){var c=!1,d=a(this).val();a(this).html("");var e=a(this);a(e).append('<option value="">N/A</option>'),a.each(b,function(){a(e).append('<option value="'+this.row+'">'+this.name+"</option>"),d===this.row&&(c=!0)}),c&&a(e).val(d)})},c.applyCritNameBlurFocus=function(){var b=a(".critNameInput");if(b.length>0){var c=a(".parent_criteria_select");c.length>0&&(a(".critNameInput").off("focus"),a(".critNameInput").on("focus",function(){critNameSwitchThis=a(this).parents("tr").attr("rowNum")}),a(".critNameInput").off("blur"),a(".critNameInput").on("blur",function(){var b=a(this).val();b=b.replace(/[^0-9a-z- \._ \/]/gi,""),a(this).val(b),a.each(c,function(){var c=a(this).children();a.each(c,function(c,d){a(d).val()==critNameSwitchThis&&a(d).text(b)})}),critNameSwitchThis=null}))}},window.config_units=c;var d={};return d.log=function(a){console.log("[GT] "+(new Date).toTimeString().split(" ")[0]+": "+a)},d.init=function(a){c.init(a),d.log("Loaded config_units.js")},d});