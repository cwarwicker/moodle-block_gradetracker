define(["jquery","jqueryui","block_gradetracker/bcpopup","block_gradetracker/freezetable","block_gradetracker/slimmenu"],function(a,b,c,d,e){var f={};f.qualification=0,f.unit=0,f.student=0,f.id=0,f.course=0,f.group=0,f.grid="",f.access="",f.tmpDate="",f.extra={},f.init=function(b){f.grid=b.type,f.access=a("#gt-access").val(),f.course=b.courseID,f.group=b.groupID,f.qualification=b.qualID,f.id=b.id,"student"===f.grid?f.student=b.id:"unit"===f.grid&&(f.unit=b.id),void 0!==b.massUpdate&&(f.extra.massUpdate=b.massUpdate),1==GT.isDebugging&&GT.notify("warning",M.util.get_string("debuggingrunning","block_gradetracker"),"c"),f.load_grid(f.access),f.bindings()},f.bindings=function(){a(".gt_switch_qual").unbind("change"),a(".gt_switch_qual").bind("change",function(b){var c=a(this).val(),d=M.cfg.wwwroot+"/blocks/gradetracker/grid.php?type="+f.grid+"&id="+f.id+"&access="+f.access+"&qualID="+c;f.course>0&&(d+="&courseID="+f.course),c>0&&(window.location=d)}),a(".gt_switch_user").unbind("change"),a(".gt_switch_user").bind("change",function(b){var c=a(this).val(),d=M.cfg.wwwroot+"/blocks/gradetracker/grid.php?type=student&id="+c+"&access="+f.access+"&qualID="+f.qualification;c>0&&(window.location=d)}),a(".gt_switch_unit").unbind("change"),a(".gt_switch_unit").bind("change",function(){var b=a(this).val();f.qualification<=0||b<=0||(window.location=M.cfg.wwwroot+"/blocks/gradetracker/grid.php?type=unit&id="+b+"&access="+f.access+"&qualID="+f.qualification+"&courseID="+f.course)}),a(".gt_switch_course").unbind("change"),a(".gt_switch_course").bind("change",function(){var b=a(this).val();if(!(f.qualification<=0)){var c="unit"===f.grid?f.unit:f.qualification;window.location=M.cfg.wwwroot+"/blocks/gradetracker/grid.php?type="+f.grid+"&id="+c+"&access="+f.access+"&qualID="+f.qualification+"&courseID="+b}}),a(".gt_switch_group").unbind("change"),a(".gt_switch_group").bind("change",function(){var b=a(this).val();if(!(f.qualification<=0||f.course<=0)){var c="unit"===f.grid?f.unit:f.qualification;window.location=M.cfg.wwwroot+"/blocks/gradetracker/grid.php?type="+f.grid+"&id="+c+"&access="+f.access+"&qualID="+f.qualification+"&courseID="+f.course+"&groupID="+b}}),a("ul.slimmenu").slimmenu({resizeWidth:"850",collapserTitle:M.util.get_string("mainmenu","block_gradetracker"),easingEffect:"easeInOutQuint",animSpeed:"medium",indentChildren:!0}),a(".gt_refresh_grid_grade").unbind("click"),a(".gt_refresh_grid_grade").bind("click",function(b){var c=a(this).attr("type");f.refresh_grades(c),b.preventDefault()}),a(".gt_load_grid").unbind("click"),a(".gt_load_grid").bind("click",function(b){var c=a(this).attr("access");f.load_grid(c),b.preventDefault()}),a(".gt_start_debugging").unbind("click"),a(".gt_start_debugging").bind("click",function(b){return 1!=GT.isDebugging&&(GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"set_debugging",params:{value:1}},function(){a(".gt_debug_start").addClass("gt_img_disable"),a(".gt_debug_stop").removeClass("gt_img_disable"),GT.notify("warning",M.util.get_string("debuggingrunning","block_gradetracker"),"c"),GT.isDebugging=1}),void b.preventDefault())}),a(".gt_stop_debugging").unbind("click"),a(".gt_stop_debugging").bind("click",function(b){return 0!=GT.isDebugging&&(GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"set_debugging",params:{value:0}},function(){a(".gt_debug_start").removeClass("gt_img_disable"),a(".gt_debug_stop").addClass("gt_img_disable"),a(".bc-notification").fadeOut("slow",function(){a(this).remove()}),GT.isDebugging=0}),void b.preventDefault())}),a(".gt_clear_debugging").unbind("click"),a(".gt_clear_debugging").bind("click",function(b){a("#gt_loading").show(),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"clear_debugging"},function(){a("#gt_loading").hide()}),b.preventDefault()}),a(".gt_criterion_date").datepicker({dateFormat:"dd-mm-yy",showButtonPanel:!0,beforeShow:function(){f.tmpDate=a(this).val();var b=a.datepicker._updateDatepicker;a.datepicker._updateDatepicker=function(c){b.call(this,c);var d=a(this).datepicker("widget").find(".ui-datepicker-buttonpane");a(d).html(""),a("<button type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+M.util.get_string("clear","block_gradetracker")+"</button>").appendTo(d).click(function(b){a.datepicker._clearDate(c.input)})}},onClose:function(b){if(b===f.tmpDate)return!1;var c=a(a(this).parents("td")[0]),d=a(c).attr("sID"),e=a(c).attr("qID"),g=a(c).attr("uID"),h=a(c).attr("cID"),i=void 0!=a(c).attr("rID")?a(c).attr("rID"):0,j=void 0!=a(this).attr("observationNum")?a(this).attr("observationNum"):0,k={studentID:d,qualID:e,unitID:g,critID:h,rID:i,date:b,obNum:j};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_criterion",params:k},function(b){0===b.length?a(c).effect("highlight",{color:"#f24c3d"},3e3):(a(c).effect("highlight",{color:"#ccff66"},3e3),f.apply_award_updates(b,d,e,g))})}}),a(".gt_criterion_award_date").datepicker({dateFormat:"dd-mm-yy",showButtonPanel:!0,beforeShow:function(){f.tmpDate=a(this).val();var b=a.datepicker._updateDatepicker;a.datepicker._updateDatepicker=function(c){b.call(this,c);var d=a(this).datepicker("widget").find(".ui-datepicker-buttonpane");a(d).html(""),a("<button type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+M.util.get_string("clear","block_gradetracker")+"</button>").appendTo(d).click(function(b){a.datepicker._clearDate(c.input)})}},onClose:function(b){if(b===f.tmpDate)return!1;var c=a(a(this).parents("td")[0]),d=a(c).attr("sID"),e=a(c).attr("qID"),g=a(c).attr("uID"),h=a(c).attr("cID"),i={studentID:d,qualID:e,unitID:g,critID:h,date:b};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_criterion_award_date",params:i},function(b){0===b.length?a(c).effect("highlight",{color:"#f24c3d"},3e3):a(c).effect("highlight",{color:"#ccff66"},3e3)})}}),a(".gt_range_observation_award_date").datepicker({dateFormat:"dd-mm-yy",showButtonPanel:!0,beforeShow:function(){f.tmpDate=a(this).val();var b=a.datepicker._updateDatepicker;a.datepicker._updateDatepicker=function(c){b.call(this,c);var d=a(this).datepicker("widget").find(".ui-datepicker-buttonpane");a(d).html(""),a("<button type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+M.util.get_string("clear","block_gradetracker")+"</button>").appendTo(d).click(function(b){a.datepicker._clearDate(c.input)})}},onClose:function(b){if(b===f.tmpDate)return!1;var c=a(a(this).parents("td")[0]),d=a(this).attr("sID"),e=a(this).attr("qID"),g=a(this).attr("uID"),h=a(this).attr("rID"),i=a(this).attr("observationNum"),j={studentID:d,qualID:e,unitID:g,rangeID:h,obNum:i,date:b};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_range_observation_award_date",params:j},function(b){0===b.length?a(c).effect("highlight",{color:"#f24c3d"},3e3):(a(c).effect("highlight",{color:"#ccff66"},3e3),f.apply_award_updates(b,d,e,g))})}}),a(".gt_criterion_checkbox").unbind("click"),a(".gt_criterion_checkbox").bind("click",function(){var b=a(a(this).parents("td")[0]),c=a(this),d=a(b).attr("sID"),e=a(b).attr("qID"),g=a(b).attr("uID"),h=a(b).attr("cID"),i=a(this).prop("checked")?1:0,j=void 0!=a(b).attr("rID")?a(b).attr("rID"):0,k=void 0!=a(this).attr("observationNum")?a(this).attr("observationNum"):0,l={studentID:d,qualID:e,unitID:g,critID:h,rID:j,met:i,obNum:k};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_criterion",params:l},function(h){0===h.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),a(c).prop("checked",!i),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):(a(b).effect("highlight",{color:"#ccff66"},3e3),f.apply_award_updates(h,d,e,g))})}),a(".gt_criterion_select").unbind("change"),a(".gt_criterion_select").bind("change",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("uID"),g=a(b).attr("cID"),h=a(this).val(),i=void 0!=a(b).attr("rID")?a(b).attr("rID"):0,j=void 0!=a(this).attr("observationNum")?a(this).attr("observationNum"):0,k={studentID:c,qualID:d,unitID:e,critID:g,rID:i,obNum:j,value:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_criterion",params:k},function(g){0===g.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):(a(b).effect("highlight",{color:"#ccff66"},3e3),f.apply_award_updates(g,c,d,e))})}),a(".gt_open_criterion_window").unbind("click"),a(".gt_open_criterion_window").bind("click",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("uID"),g=a(b).attr("cID"),h=a(b).attr("cName"),i=a("#gt-access").val();a(document).bcPopUp({title:h,buttons:{Save:function(){a("#gt_popup_loader").show(),a("#gt_popup_error").hide(),a("#gt_popup_success").hide(),a(a(".bc-modal-body")[0]).scrollTop(0);var b=new Array;a(".gt_criterion_wrapper .gt_update_comments").each(function(){var c=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("qID"),d=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("uID"),e=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("cID"),f=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("sID"),g=a(this).val();b.push({studentID:f,qualID:c,unitID:d,critID:e,value:g})}),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_sub_criterion_comments",params:b},function(b){a("#gt_popup_loader").hide(),0===b.length?a("#gt_popup_error").fadeIn():a("#gt_popup_success").fadeIn()})}},open:function(){a(".bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a(".bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_popup",params:{studentID:c,qualID:d,unitID:e,critID:g,access:i}},function(){f.bindings()})},allowMultiple:!1})}),a(".gt_open_detail_criterion_window").unbind("click"),a(".gt_open_detail_criterion_window").bind("click",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("uID"),g=a(b).attr("cID"),h=a(b).attr("cName"),i=a("#gt-access").val();a(document).bcPopUp({title:h,buttons:{Save:function(){a("#gt_detail_popup_loader").show(),a("#gt_detail_popup_error").hide(),a("#gt_detail_popup_success").hide(),a(a(".bc-modal-body")[0]).scrollTop(0);var b=new Array;a(".gt_detail_criterion_wrapper .gt_update_comments, .gt_detail_criterion_wrapper .gt_update_custom_value").each(function(){var c=a(a(this).parents(".gt_detail_criterion_wrapper")[0]).attr("qID"),d=a(a(this).parents(".gt_detail_criterion_wrapper")[0]).attr("uID"),e=a(a(this).parents(".gt_detail_criterion_wrapper")[0]).attr("cID"),f=a(a(this).parents(".gt_detail_criterion_wrapper")[0]).attr("sID"),g=a(this).attr("type"),h=a(this).val();b.push({studentID:f,qualID:c,unitID:d,critID:e,type:g,value:h})}),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_detail_criterion",params:b},function(b){a("#gt_detail_popup_loader").hide(),0===b.length?a("#gt_detail_popup_error").fadeIn():a("#gt_detail_popup_success").fadeIn()})}},open:function(){a(".bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a(".bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_popup",params:{studentID:c,qualID:d,unitID:e,critID:g,access:i}},function(){f.bindings()})},allowMultiple:!1})}),a(".gt_open_numeric_criterion_window").unbind("click"),a(".gt_open_numeric_criterion_window").bind("click",function(b){var c=a(a(this).parents("td")[0]),d=a(c).attr("sID"),e=a(c).attr("qID"),g=a(c).attr("uID"),h=a(c).attr("cID"),i=a(c).attr("cName"),j=a("#gt-access").val();a(document).bcPopUp({title:i,buttons:{Save:function(){a("#gt_popup_loader").show(),a("#gt_popup_error").hide(),a("#gt_popup_success").hide(),a(a(".bc-modal-body")[0]).scrollTop(0);var b=new Array;a(".gt_criterion_wrapper .gt_update_comments").each(function(){var c=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("qID"),d=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("uID"),e=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("cID"),f=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("sID"),g=a(this).val();b.push({studentID:f,qualID:c,unitID:d,critID:e,value:g})}),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_sub_criterion_comments",params:b},function(b){a("#gt_popup_loader").hide(),0===b.length?a("#gt_popup_error").fadeIn():a("#gt_popup_success").fadeIn()})}},open:function(){a(".bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a(".bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_popup",params:{studentID:d,qualID:e,unitID:g,critID:h,access:j}},function(){f.bindings(),GT.centre(a(".bc-modal"))})},allowMultiple:!1}),b.preventDefault()}),a(".gt_update_numeric_point").unbind("click"),a(".gt_update_numeric_point").bind("click",function(){var b=a(a(this).parents("td")[0]),c=a(this).attr("sID"),d=a(this).attr("qID"),e=a(this).attr("uID"),f=a(this).attr("cID"),g=void 0!==a(this).attr("rID")?a(this).attr("rID"):0,h=a(this).val(),i={studentID:c,qualID:d,unitID:e,critID:f,rangeID:g,value:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_numeric_point",params:i},function(c){var d=a.parseJSON(c);0===c.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):(a("#gt_total_points").text(d.points),d.awardID>0&&d.awardCriterion>0?(a("#gt_criterion_value_"+d.awardCriterion+" select").val(d.awardID),a("#gt_criterion_value_"+d.awardCriterion).effect("highlight",{color:"#ccff66"},1e3)):d.awardID===!1&&d.awardCriterion>0&&(a("#gt_criterion_value_"+d.awardCriterion+" select").val("0"),a("#gt_criterion_value_"+d.awardCriterion).effect("highlight",{color:"#ccff66"},1e3)),d.parentAwardID>0&&d.parentCriterion>0?(a("#gt_criterion_value_"+d.parentCriterion+" select").val(d.parentAwardID),a("#gt_criterion_value_"+d.parentCriterion).effect("highlight",{color:"#ccff66"},1e3)):d.parentAwardID===!1&&d.parentCriterion>0&&(a("#gt_criterion_value_"+d.parentCriterion+" select").val("0"),a("#gt_criterion_value_"+d.parentCriterion).effect("highlight",{color:"#ccff66"},1e3)),a(b).effect("highlight",{color:"#ccff66"},3e3))})}),a(".gt_open_ranged_criterion_window").unbind("click"),a(".gt_open_ranged_criterion_window").bind("click",function(b){var c=a(a(this).parents("td")[0]),d=a(c).attr("sID"),e=a(c).attr("qID"),g=a(c).attr("uID"),h=a(c).attr("cID"),i=a(c).attr("cName"),j=a("#gt-access").val();a(document).bcPopUp({title:i,buttons:{Save:function(){a("#gt_popup_loader").show(),a("#gt_popup_error").hide(),a("#gt_popup_success").hide(),a(a(".bc-modal-body")[0]).scrollTop(0);var b=new Array;a(".gt_criterion_wrapper .gt_update_comments").each(function(){var c=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("qID"),d=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("uID"),e=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("cID"),f=a(a(this).parents(".gt_criterion_wrapper")[0]).attr("sID"),g=a(this).val();b.push({studentID:f,qualID:c,unitID:d,critID:e,value:g})}),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_sub_criterion_comments",params:b},function(b){a("#gt_popup_loader").hide(),0===b.length?a("#gt_popup_error").fadeIn():a("#gt_popup_success").fadeIn()})}},open:function(){a(".bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a(".bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_popup",params:{studentID:d,qualID:e,unitID:g,critID:h,access:j}},function(){f.bindings()})},allowMultiple:!1}),b.preventDefault()}),a(".gt_comment_icon").unbind("click"),a(".gt_comment_icon").bind("click",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("uID"),g=a(b).attr("cID"),h=a(b).attr("cName");a(document).bcPopUp({title:M.util.get_string("comments","block_gradetracker")+" - "+h,buttons:{Save:function(){a(a(".bc-modal-body")[0]).scrollTop(0);var b=a(a(".gt_criterion_comments_textbox")[0]),c=a(a(b).parents("div")[0]),d=a(b).attr("qID"),e=a(b).attr("uID"),f=a(b).attr("sID"),g=a(b).attr("cID"),h=a.trim(a(b).val()),i=a("#CRITERION_Q_"+d+"U_"+e+"C_"+g+"S_"+f),j={studentID:f,qualID:d,unitID:e,critID:g,value:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_criterion_comments",params:j},function(b){if(0===b.length)a(c).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"));else{a(c).effect("highlight",{color:"#ccff66"},3e3),h.length>0&&!a(i).hasClass("gt_has_comments")?a(i).addClass("gt_has_comments"):0===h.length&&a(i).removeClass("gt_has_comments");var d=h.length>0?"comment_edit.png":"comment_add.png";a(a(i).find("img.gt_comment_icon")[0]).attr("src",M.cfg.wwwroot+"/blocks/gradetracker/pix/"+d),a(".bc-modal").each(function(){a(this).bcPopUp("close")})}})}},open:function(){a(".bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a(".bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_comment_popup",params:{studentID:c,qualID:d,unitID:e,critID:g}},function(){f.bindings()})},allowMultiple:!1})}),a(".gt_assessment_comment_edit").unbind("click"),a(".gt_assessment_comment_edit").bind("click",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("aID"),g=a(b).attr("qName"),h=a(b).attr("aName");a(document).bcPopUp({title:M.util.get_string("comments","block_gradetracker")+" - "+g+" - "+h,buttons:{Save:function(){a(a(".bc-modal-body")[0]).scrollTop(0),a("#gt_comment_loading").show();var c=a(a(".gt_assessment_comments_textbox")[0]),d=a(a(c).parents("div")[0]),e=a(c).attr("qID"),f=a(c).attr("aID"),g=a(c).attr("sID"),h=a.trim(a(c).val()),i={studentID:g,qualID:e,assID:f,value:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_assessment_comments",params:i},function(c){if(0===c.length)a(d).effect("highlight",{color:"#f24c3d"},3e3),a("#gt_comment_loading").hide(),alert(M.util.get_string("couldnotupdate","block_gradetracker"));else{a("#gt_comment_loading").hide(),h.length>0&&!a(b).hasClass("gt_has_comments")?a(b).addClass("gt_has_comments"):0===h.length&&a(b).removeClass("gt_has_comments");var e=h.length>0?"comment_edit.png":"comment_add.png";a(a(b).find("img.gt_assessment_comment_edit")[0]).attr("src",M.cfg.wwwroot+"/blocks/gradetracker/pix/"+e),a(".bc-modal").each(function(){a(this).bcPopUp("close")})}})}},open:function(){a(".bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a(".bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_assessment_comment_popup",params:{studentID:c,qualID:d,assID:e}},function(){f.bindings()})},allowMultiple:!1})}),a("select.gt_grid_unit_award").unbind("change"),a("select.gt_grid_unit_award").bind("change",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("uID"),g=a(this).val();if(0==a(b).length)return!1;var h={studentID:c,qualID:d,unitID:e,value:g};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_unit",params:h},function(h){0===h.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):(f.apply_award_updates(h,c,d,e),a(b).effect("highlight",{color:"#ccff66"},3e3),a("select.gt_grid_unit_award.S"+c+"_Q"+d+"_U"+e).val(g))})}),a("a.gt_unit_info").unbind("click"),a("a.gt_unit_info").bind("click",function(b){var c=a(this).attr("uID"),d=a(this).attr("uName"),e=a("#gt-external").length>0?1:0,g=1===a("#gt-ext-sid").length?a("#gt-ext-sid").val():0;a("#pUUI_"+c).bcPopUp({title:d,open:function(){a("#pUUI_"+c+" .bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a("#pUUI_"+c+" .bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_unit_info_popup",params:{unitID:c,external:e,extSsn:g}},function(){f.bindings()})},allowMultiple:!0,showOverlay:!1}),b.preventDefault()}),a("td.gt_grid_cell_e, td.gt_grid_cell_ae").unbind("dblclick"),a("td.gt_grid_cell_e, td.gt_grid_cell_ae").bind("dblclick",function(){var b=a(this).attr("sID"),c=a(this).attr("qID"),d=a(this).attr("uID"),e=a(this).attr("cID"),g=a(this).attr("cName"),h=a("#gt-external").length>0?1:0,i=1===a("#gt-ext-sid").length?a("#gt-ext-sid").val():0;a("#pU_"+b+"_"+c+"_"+d+"_"+e).bcPopUp({title:g,open:function(){a("#pU_"+b+"_"+c+"_"+d+"_"+e+" .bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a("#pU_"+b+"_"+c+"_"+d+"_"+e+" .bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_info_popup",params:{studentID:b,qualID:c,unitID:d,critID:e,external:h,extSsn:i}},function(){f.bindings()})},allowMultiple:!0,showOverlay:!1})}),a("td.gt_grid_cell_v, img.gt_edit_info_icon").unbind("click"),a("td.gt_grid_cell_v, img.gt_edit_info_icon").bind("click",function(){var b=a(this).attr("sID"),c=a(this).attr("qID"),d=a(this).attr("uID"),e=a(this).attr("cID"),g=a(this).attr("cName"),h=a("#gt-external").length>0?1:0,i=1===a("#gt-ext-sid").length?a("#gt-ext-sid").val():0;a("#pU_"+b+"_"+c+"_"+d+"_"+e).bcPopUp({title:g,open:function(){a("#pU_"+b+"_"+c+"_"+d+"_"+e+" .bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a("#pU_"+b+"_"+c+"_"+d+"_"+e+" .bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_criterion_info_popup",params:{studentID:b,qualID:c,unitID:d,critID:e,external:h,extSsn:i}},function(){f.bindings()})},allowMultiple:!0,showOverlay:!1})}),a("td.gt_assessment_grid_cell_v").unbind("click"),a("td.gt_assessment_grid_cell_v").bind("click",function(){var b=a(this).attr("sID"),c=a(this).attr("qID"),d=a(this).attr("aID"),e=a(this).attr("aName"),g=a("#gt-external").length>0?1:0,h=1===a("#gt-ext-sid").length?a("#gt-ext-sid").val():0;a("#pU_"+b+"_"+c+"_"+d).bcPopUp({title:e,open:function(){a("#pU_"+b+"_"+c+"_"+d+" .bc-modal-body").html('<img src="'+M.cfg.wwwroot+'/blocks/gradetracker/pix/ajax-loader.gif" />'),a("#pU_"+b+"_"+c+"_"+d+" .bc-modal-body").load(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_assessment_info_popup",params:{studentID:b,qualID:c,assID:d,external:g,extSsn:h}},function(){f.bindings()})},allowMultiple:!0,showOverlay:!1})}),a(".gt_load_range").unbind("click"),a(".gt_load_range").bind("click",function(b){a(this).parents("ul.gt_tabbed_list").find("li").removeClass("active"),a(this).parent().addClass("active");var c=a(a(this).parents("div.bc-modal-body").find("div#gt_popup_range_info")[0]);a(c).html('<img src="'+M.util.image_url("i/loading_small")+'" alt="'+M.util.get_string("loading","block_gradetracker")+'" />');var d=a(this).attr("sID"),e=a(this).attr("qID"),g=a(this).attr("uID"),h=a(this).attr("cID"),i=a(this).attr("editing"),j={studentID:d,qualID:e,unitID:g,critID:h,editing:i};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_range_info",params:j},function(b){a(c).html(b),f.bindings()}),b.preventDefault()}),a(".gt_add_ranged_observation").unbind("click"),a(".gt_add_ranged_observation").bind("click",function(){var b=a("#gt_ranged_observations_table"),c=a(b).find("tr"),d=a(b).find("th.gt_obnum").length,e=d+1;a.each(c,function(){var b=a(this).find("th:nth-last-child(2)"),c=a(this).find("td:nth-last-child(1)");if(b.length>0)a(b).after('<th class="gt_obnum gt_c">'+e+"</th>");else if(c.length>0){var d=a(c).clone();a(d).find("select").attr("observationNum",e).val(0).prop("checked",!1),a(d).find("input").attr("observationNum",e).val("").prop("checked",!1),a(d).find("input").removeClass("gt_hasDatepicker"),a(d).find("input").attr("id",a(d).find("input").attr("id")+"_"+e),a(c).after(d)}}),f.bindings()}),a(".gt_assessment_select").unbind("change"),a(".gt_assessment_select").bind("change",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("aID"),f=a(b).attr("type"),g=a(this).val(),h=a(this).attr("gradingMethod"),i={studentID:c,qualID:d,assessmentID:e,type:f,value:g,gradingMethod:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_assessment",params:i},function(c){0===c.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):a(b).effect("highlight",{color:"#ccff66"},3e3)})}),a(".gt_stud_unit_IV_who").unbind("change"),a(".gt_stud_unit_IV_who").bind("change",function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("uID"),f=a(this).val(),g={type:"unit",attribute:"IV_who",studentID:c,qualID:d,unitID:e,value:f};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_user_attribute",params:g},function(c){0===c.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):a(b).effect("highlight",{color:"#ccff66"},3e3)})}),a(".gt_stud_unit_IV_date").datepicker({dateFormat:"dd-mm-yy",showButtonPanel:!0,beforeShow:function(){var b=a.datepicker._updateDatepicker;a.datepicker._updateDatepicker=function(c){b.call(this,c);var d=a(this).datepicker("widget").find(".ui-datepicker-buttonpane");a(d).html(""),a("<button type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+M.util.get_string("clear","block_gradetracker")+"</button>").appendTo(d).click(function(b){a.datepicker._clearDate(c.input)})}},onClose:function(b){var c=a(a(this).parents("td")[0]),d=a(c).attr("sID"),e=a(c).attr("qID"),f=a(c).attr("uID"),g={type:"unit",attribute:"IV_date",studentID:d,qualID:e,unitID:f,value:b};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_user_attribute",params:g},function(b){0===b.length?(a(c).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):a(c).effect("highlight",{color:"#ccff66"},3e3)})}});var b=function(){var b=a(a(this).parents("td")[0]),c=a(b).attr("sID"),d=a(b).attr("qID"),e=a(b).attr("aID"),f=a(b).attr("fID"),g=a(this).val();if("checkbox"==a(this).attr("type")){var h=a(this).prop("checked");g=0|h}var i={studentID:c,qualID:d,assessmentID:e,fieldID:f,value:g};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"update_student_assessment_custom_field",params:i},function(g){0===g.length?(a(b).effect("highlight",{color:"#f24c3d"},3e3),alert(M.util.get_string("couldnotupdate","block_gradetracker"))):(a(b).effect("highlight",{color:"#ccff66"},3e3),a("#q_"+d+"s_"+c+"a_"+e+"f_"+f+"_msg").remove())})},c="";a("select.gt_assessment_custom_field").unbind("change"),a("input.gt_assessment_custom_field").unbind("change").unbind("click").unbind("blur"),a("textbox.gt_assessment_custom_field").unbind("change").unbind("click").unbind("blur"),a('select.gt_assessment_custom_field, input[type!="checkbox"].gt_assessment_custom_field, textarea.gt_assessment_custom_field').bind("change",b),a('select.gt_assessment_custom_field, input[type!="checkbox"].gt_assessment_custom_field, textarea.gt_assessment_custom_field').bind("blur",function(){var b=a(this).val();if(b==c){var d=a(a(this).parents("td")[0]),e=a(d).attr("sID"),f=a(d).attr("qID"),g=a(d).attr("aID"),h=a(d).attr("fID");c="",a("#q_"+f+"s_"+e+"a_"+g+"f_"+h+"_msg").remove()}}),a('input[type="checkbox"].gt_assessment_custom_field').bind("click",b),a('input[type!="checkbox"].gt_assessment_custom_field, textarea.gt_assessment_custom_field').unbind("focus"),a('input[type!="checkbox"].gt_assessment_custom_field, textarea.gt_assessment_custom_field').bind("focus",function(){var b=a(a(this).parents("td")[0]),d=a(b).attr("sID"),e=a(b).attr("qID"),f=a(b).attr("aID"),g=a(b).attr("fID");c=a(this).val(),a("#q_"+e+"s_"+d+"a_"+f+"f_"+g+"_msg").remove(),a(this).after('<div id="q_'+e+"s_"+d+"a_"+f+"f_"+g+'_msg"><small class="gt_label">'+M.util.get_string("unsaved","block_gradetracker")+"</small></div>")}),a(".gt_change_grid_page").unbind("click"),a(".gt_change_grid_page").bind("click",function(b){var c=a(this).attr("page");a("#gt-page").val(c),a(".gt_pagenumber").removeClass("active"),a(".gt_pagenumber_"+c).addClass("active"),f.load_grid(),b.preventDefault()}),a("#gt_mass_switch_crit").unbind("change"),a("#gt_mass_switch_crit").bind("change",function(){var b=a(this).val(),c=a("#gt_mass_switch_value");if(""!==b){c.html("<option></option>");var d=f.extra.massUpdate[b];a.each(d,function(a,b){c.append('<option value="'+b[1]+'">'+b[0]+"</option>")})}else c.html("")}),a("#gt_mass_update_btn").unbind("click"),a("#gt_mass_update_btn").bind("click",function(){var b=a("#gt-qID").val(),c=a("#gt-uID").val(),d=a("#gt-crID").val(),e=a("#gt-groupID").val(),f=a("#gt_mass_switch_crit").val(),g=a("#gt_mass_switch_value").val();a("#gt_mass_update_loading").show();var h=new Array;h.push({qualID:b,unitID:c,courseID:d,critID:f,groupID:e,valueID:g}),GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/update.php",{action:"mass_update_student_detail_criterion",params:h},function(d){if(a("#gt_mass_update_loading").hide(),0===d.length)var e="#f24c3d";else var e="#ccff66";var h="gt_criteria["+b+"]["+c+"]["+f+"]",j=a('[name="'+h+'"]');for(i=0;i<j.length;i++)j[i].value=g;j.parent().effect("highlight",{color:e},3e3)})}),a(".class").unbind("click"),a(".class").bind("click",function(a){a.preventDefault()})},f.refresh_grades=function(b,c){var d=f.qualification;"student"===f.grid&&(c=f.student);var e={};if(a("#gt_refresh_"+b+"_loader").show(),"gcse"===b)e={action:"get_refreshed_gcse_score",params:{studentID:c}};else if("tg"===b){if(a(".gt-qID").length>0){var g=new Array;a(".gt-qID").each(function(){g.push(a(this).val())}),d=g}var e={action:"get_refreshed_target_grade",params:{studentID:c,qualID:d}}}else if("wtg"===b){if(a(".gt-qID").length>0){var g=new Array;a(".gt-qID").each(function(){g.push(a(this).val())}),d=g}var e={action:"get_refreshed_weighted_target_grade",params:{studentID:c,qualID:d}}}else if("pg"===b)var e={action:"get_refreshed_predicted_grades",params:{studentID:c,qualID:d}};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",e,function(e){e=a.parseJSON(e),"gcse"===b?void 0!==e.score&&a("#gt_user_gcse_score").text(e.score):"tg"===b?e.gradeID instanceof Array||e.gradeID instanceof Object?(a.each(e.gradeID,function(b,d){d.length>0&&a("#gt_user_target_grade_"+c+"_"+b+" > select.gt_target_grade_award").val(d)}),a.each(e.grade,function(b,d){d.length>0&&a("#gt_user_target_grade_"+c+"_"+b+" > span").text(d)})):(void 0!==e.gradeID&&a("#gt_user_target_grade_"+c+"_"+d+" > select.gt_target_grade_award").val(e.gradeID),void 0!==e.grade&&a("#gt_user_target_grade_"+c+"_"+d+" > span").text(e.grade)):"wtg"===b?e.gradeID instanceof Array||e.gradeID instanceof Object?a.each(e.grade,function(b,d){d.length>0&&a("#gt_user_weighted_target_grade_"+c+"_"+b+" > span").text(d)}):void 0!==e.grade&&a("#gt_user_weighted_target_grade_"+c+"_"+d+" > span").text(e.grade):"pg"===b&&(void 0!==e.average&&("student"===f.grid?a("#gt_user_avg_award").text(e.average):"class"!==f.grid&&"unit"!==f.grid||a(".qual_award_"+c+"_"+d).html("Predicted<br>"+e.average)),void 0!==e.min&&a("#gt_user_min_award").text(e.min),void 0!==e.max&&a("#gt_user_max_award").text(e.max),void 0!==e["final"]&&("student"===f.grid?a("#gt_user_final_award").text(e["final"]):"class"!==f.grid&&"unit"!==f.grid||a(".qual_award_"+c+"_"+d).html("Final<br>"+e["final"]))),a("#gt_refresh_"+b+"_loader").hide()})},f.apply_award_updates=function(b,c,d,e){if(b=a.parseJSON(b),void 0!==b.awards&&a.each(b.awards,function(b,d){var e=a(".gt_grid_cell[sid="+c+"][cid="+b+"] :input");e.val();e.length>0&&("checkbox"==e.attr("type")?d>0?e.prop("checked",!0):e.prop("checked",!1):e.val(d),
a(e.parents("td")[0]).effect("highlight",{color:"#ccff66"},3e3))}),void 0!==b.unitawards&&a.each(b.unitawards,function(b,f){var g=a(".S"+c+"_Q"+d+"_U"+e);g.val();g.length>0&&g.val(f)}),void 0!==b.progress){var g="S"+c+"Q"+d+"U"+e,h=a(".progress_bar_"+g),i=a(".progress_percent_"+g);for(x=0;x<h.length;x++)h[x].style.width=b.progress+"%";for(x=0;x<i.length;x++)i[x].innerHTML=b.progress+"%"}f.refresh_grades("pg",c)},f.load_grid=function(a){void 0===a&&(a=f.access),"student"===f.grid?f.load_student_grid(a):"unit"===f.grid?f.load_unit_grid(a):"class"===f.grid&&f.load_class_grid(a)},f.student_bindings=function(){var b=a(".gt_grid_freeze_col").length;b<1&&(b=1),a("#gt_grid_holder").freezeTable("destroy"),a("#gt_grid_holder").freezeTable({columnNum:b,scrollable:!0,shadow:!0,freezeHead:!0}),f.bindings()},f.unit_bindings=function(){a("#gt_grid_holder").freezeTable("destroy");var b=a(".gt_grid_freeze_col").length;a("#gt_grid_holder").freezeTable({columnNum:b,scrollable:!0,shadow:!0,freezeHead:!0}),f.bindings()},f.class_bindings=function(){a("#gt_grid_holder").freezeTable("destroy");var b=a(".gt_grid_freeze_col").length;a("#gt_grid_holder").freezeTable({columnNum:b,scrollable:!0,shadow:!0,freezeHead:!0}),f.bindings()},f.load_student_grid=function(b){a("#gt_loading").show();var c=f.qualification,d=f.student,e=a("#gt-assessmentView").val(),g=a("#gt-external").length>0?1:0;1==GT.isKeyPressed(17)&&"e"===b&&(b="ae"),"e"==b?(a("#gt_edit_button").hide(),a("#gt_adv_edit_button").show()):"ae"!=b&&"v"!=b||(a("#gt_adv_edit_button").hide(),a("#gt_edit_button").show()),"e"==b||"ae"==b?(a(".gt_tg_Q"+c+"_S"+d+"_view").hide(),a(".gt_tg_Q"+c+"_S"+d+"_edit").show(),a(".gt_asp_Q"+c+"_S"+d+"_view").hide(),a(".gt_asp_Q"+c+"_S"+d+"_edit").show()):(a(".gt_tg_Q"+c+"_S"+d+"_view").show(),a(".gt_tg_Q"+c+"_S"+d+"_edit").hide(),a(".gt_asp_Q"+c+"_S"+d+"_view").show(),a(".gt_asp_Q"+c+"_S"+d+"_edit").hide());var h=1===a("#gt-ext-sid").length?a("#gt-ext-sid").val():0,i={qualID:c,studentID:d,access:b,assessmentView:e,external:g,extSsn:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_student_grid",params:i},function(c){c=a.parseJSON(c),a("#gt_grid_holder").html(c),a("#gt_loading").hide(),f.access=b,f.student_bindings()})},f.load_unit_grid=function(b){a("#gt_loading").show();var c=f.qualification,d=f.unit,e=f.course,g=f.group,h=a("#gt-page").val(),i=a("#gt-view").val();a("#gt_unit_mass_update").hide(),1==GT.isKeyPressed(17)&&"e"===b&&(b="ae"),"e"==b?(a("#gt_edit_button").hide(),a("#gt_adv_edit_button").show()):"ae"!=b&&"v"!=b||(a("#gt_adv_edit_button").hide(),a("#gt_edit_button").show());var j={qualID:c,unitID:d,courseID:e,groupID:g,access:b,page:h,view:i};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_unit_grid",params:j},function(c){c=a.parseJSON(c),a("#gt_grid_holder").html(c),a("#gt_loading").hide(),"ae"===b&&a("#gt_unit_mass_update").show(),f.access=b,f.unit_bindings()})},f.load_class_grid=function(b){a("#gt_loading").show();var c=f.qualification,d=f.course,e=f.group,g=a("#gt-page").val(),h=a("#gt-assessmentView").val();1==GT.isKeyPressed(17)&&"e"===b&&(b="ae"),"e"==b?(a("#gt_edit_button").hide(),a("#gt_adv_edit_button").show()):"ae"!=b&&"v"!=b||(a("#gt_adv_edit_button").hide(),a("#gt_edit_button").show());var i={qualID:c,courseID:d,groupID:e,access:b,page:g,assessmentView:h};GT.ajax(M.cfg.wwwroot+"/blocks/gradetracker/ajax/get.php",{action:"get_class_grid",params:i},function(c){c=a.parseJSON(c),a("#gt_grid_holder").html(c),a("#gt_loading").hide(),f.access=b,f.class_bindings()})};var g={};return g.scripts=f,g.log=function(a){console.log("[GT] "+(new Date).toTimeString().split(" ")[0]+": "+a)},g.init=function(a){f.init(a),g.log("Loaded grids.js")},g});