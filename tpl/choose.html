<?php if(!defined('BCGT')) exit; ?>

<div class='gt_full_page'>

    <ul class="gt_tabrow">

        <?php if ($User->hasCapability('block/gradetracker:view_student_grids')): ?>
            <li class="<?php echo ($type == 'student') ? 'selected' : '' ?>">
                <a href="choose.php?type=student<?php echo (isset($myCourseID) && $myCourseID) ? '&myCourseID='.$myCourseID : '' ?>">
                    <?php echo $string['viewbystudent'] ?>
                </a>
            </li>
        <?php endif; ?>

        <?php if ($User->hasCapability('block/gradetracker:view_unit_grids')): ?>
            <li class="<?php echo ($type == 'unit') ? 'selected' : '' ?>">
                <a href="choose.php?type=unit<?php echo (isset($myCourseID) && $myCourseID) ? '&myCourseID='.$myCourseID : '' ?>">
                    <?php echo $string['viewbyunit'] ?>
                </a>
            </li>
        <?php endif; ?>

        <?php if ($User->hasCapability('block/gradetracker:view_class_grids')): ?>
            <li class="<?php echo ($type == 'class') ? 'selected' : '' ?>">
                <a href="choose.php?type=class<?php echo (isset($myCourseID) && $myCourseID) ? '&myCourseID='.$myCourseID : '' ?>">
                    <?php echo $string['viewbyclass'] ?>
                </a>
            </li>
        <?php endif; ?>

    </ul>

    <br>

    <div class='gt_form_panel'>

        <div class='gt_form_panel_heading'><?php echo $string['selectgrid'] ?></div>

        <div class='gt_form_panel_body'>

            <div class="gt_page_col_33">

                <div>

                    <div class="gt_form_panel_sub_heading">
                        <?php echo $string['gridfilters'] ?>
                    </div>

                    <div class="gt_form_panel_body">

                        <form action="" method="post">
                            <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />

                            <div>

                                <small><?php echo $string['myquals'] ?></small><br>
                                <select id="gt_choose_filter_my_qual" name="myQualID" class="gt_form_control">
                                    <option value=""><?php echo $string['pleaseselect'] ?></option>
                                    <?php if ($User->getQualifications("STAFF")): ?>
                                        <?php foreach($User->getQualifications("STAFF") as $qual): ?>
                                            <option value="<?php echo $qual->getID() ?>" <?php echo (isset($myQualID) && $myQualID == $qual->getID()) ? 'selected' : ''; ?> ><?php echo $qual->getDisplayName() ?></option>
                                        <?php endforeach; ?>
                                    <?php endif; ?>
                                </select>

                            </div>

                            <br>

                            <div>

                                <small><?php echo $string['mycourses'] ?></small><br>
                                <select id="gt_choose_filter_my_course" name="myCourseID" class="gt_form_control">
                                    <option value=""><?php echo $string['pleaseselect'] ?></option>
                                    <?php if ($User->getCourses("STAFF")): ?>
                                        <?php foreach($User->getCourses("STAFF") as $course): ?>
                                            <option value="<?php echo $course->id ?>" <?php echo (isset($myCourseID) && $myCourseID == $course->id) ? 'selected' : ''; ?> ><?php echo $course->getName() ?></option>
                                        <?php endforeach; ?>
                                    <?php endif; ?>
                                </select>

                            </div>

                            <br>

                            <div>
                                <input type="submit" class="gt_btn gt_blue" name="submit_filter_my" value="<?php echo $string['filter'] ?>" />
                            </div>

                        </form>

                    </div>

                </div>

                <br><br>

                <?php if ( $User->hasCapability('block/gradetracker:view_all_quals') ): ?>

                    <div>

                        <div class="gt_form_panel_sub_heading">
                            <?php echo $string['fullgridaccess'] ?>
                        </div>

                        <div class="gt_form_panel_body">

                            <form action="" method="post">
                                <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />

                                <div>
                                    <small><?php echo $string['allquals'] ?></small><br>
                                    <select id="gt_choose_filter_all_qual" name="searchQualID" class="gt_form_control">
                                        <option value=""><?php echo $string['pleaseselect'] ?></option>
                                        <?php if ($allQuals): ?>
                                            <?php foreach( $allQuals as $qual ): ?>
                                                <option value="<?php echo $qual->getID() ?>" <?php echo (isset($searchAllQID) && $searchAllQID == $qual->getID()) ? 'selected' : ''; ?> ><?php echo $qual->getDisplayName() ?></option>
                                            <?php endforeach; ?>
                                        <?php endif; ?>
                                    </select>
                                </div>

                                <br>

                                <div>

                                    <small><?php echo $string['allcourses'] ?></small><br>
                                    <select id="gt_choose_filter_all_course" name="searchCourseID" class="gt_form_control">
                                        <option value=""><?php echo $string['pleaseselect'] ?></option>
                                        <?php if ($allCourses): ?>
                                            <?php foreach( $allCourses as $course ): ?>
                                                <option value="<?php echo $course->id ?>" <?php echo (isset($searchAllCID) && $searchAllCID == $course->id) ? 'selected' : ''; ?> ><?php echo $course->getName() ?></option>
                                            <?php endforeach; ?>
                                        <?php endif; ?>
                                    </select>
                                </div>

                                <br>

                                <div>
                                    <input type="submit" class="gt_btn gt_blue" name="submit_filter_all" value="<?php echo $string['filter'] ?>" />
                                </div>

                            </form>

                        </div>

                    </div>

                <?php endif; ?>

            </div>

            <div class="gt_page_col_66">

                <div class="gt_form_panel_sub_heading">
                    <?php echo $string['results'] ?>
                    <?php if (isset($searchQualification) && $searchQualification): ?>
                        - <?php echo $searchQualification->getDisplayName() ?>
                    <?php elseif (isset($searchCourse) && $searchCourse): ?>
                        - <?php echo $searchCourse->getName() ?>
                    <?php endif; ?>
                </div>

                <div class="gt_form_panel_body">

                    <?php if (isset($results) && $results): ?>

                            <?php if ($type == 'student'): ?>

                                <?php foreach($results as $cID => $quals): ?>

                                    <?php if ($cID > 0): ?>
                                        <h3 class="gt_form_heading">
                                            <a href="<?php echo $CFG->wwwroot ?>/course/view.php?id=<?php echo $cID ?>"><?php echo \GT\Course::getNameById($cID) ?></a>
                                        </h3>
                                    <?php endif; ?>

                                    <?php if ($quals): ?>

                                        <?php foreach($quals as $qID => $rows): ?>

                                            <h4 class="gt_form_heading <?php echo (!$User->isOnQual($qID, 'STAFF')) ? 'gt_no_access' : ''; ?>"><?php echo \GT\Qualification::getNameByID($qID) ?></h4>

                                            <?php if ($rows): ?>

                                                <table class="gt_filter_results">

                                                    <?php foreach($rows as $row): ?>

                                                        <tr>
                                                            <td><?php echo $row->getPicture() ?></td>
                                                            <td><?php echo $row->getName() ?></td>
                                                            <td><?php echo $row->username ?></td>
                                                            <td>
                                                                <?php if($User->canAccessQual($qID, 'STAFF')): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=student&id=<?php echo $row->id ?>&qualID=<?php echo $qID ?>&courseID=<?php echo $courseID ?>&access=v" target="_blank"><?php echo $string['viewgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <td>
                                                                <?php if($User->canEditQual($qID)): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=student&id=<?php echo $row->id ?>&qualID=<?php echo $qID ?>&courseID=<?php echo $courseID ?>&access=e" target="_blank"><?php echo $string['editgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <td>
                                                                <?php if($User->canEditQual($qID)): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=student&id=<?php echo $row->id ?>&qualID=<?php echo $qID ?>&courseID=<?php echo $courseID ?>&access=ae" target="_blank"><?php echo $string['advancededitgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>

                                                            <?php if (\GT\Qualification::hasAssessments($qID)): ?>
                                                                <td>
                                                                    <?php if($User->canAccessQual($qID, 'STAFF')): ?>
                                                                        <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=student&id=<?php echo $row->id ?>&qualID=<?php echo $qID ?>&courseID=<?php echo $courseID ?>&ass=1" target="_blank"><?php echo $string['assessmentgrid'] ?></a>
                                                                    <?php endif; ?>
                                                                </td>
                                                            <?php endif; ?>

                                                        </tr>

                                                    <?php endforeach; ?>

                                                </table>

                                            <?php else: ?>

                                                <p class="gt_centre"><?php echo $string['qualnostuds'] ?></p>

                                            <?php endif; ?>

                                            <br>

                                        <?php endforeach; ?>

                                    <?php endif; ?>

                                <?php endforeach; ?>






                            <?php elseif ($type == 'unit'): ?>

                                <?php foreach($results as $cID => $quals): ?>

                                    <?php if ($cID > 0): ?>
                                        <h3 class="gt_form_heading"><?php echo \GT\Course::getNameById($cID) ?></h3>
                                    <?php endif; ?>

                                    <?php if ($quals): ?>

                                        <?php foreach($quals as $qID => $units): ?>

                                            <h4 class="gt_form_heading <?php echo (!$User->isOnQual($qID, 'STAFF')) ? 'gt_no_access' : ''; ?>"><?php echo \GT\Qualification::getNameByID($qID) ?></h4>

                                            <?php if ($units): ?>

                                                <table class="gt_filter_results">

                                                    <?php foreach($units as $unit): ?>

                                                        <tr>
                                                            <td><?php echo $unit->getDisplayName() ?></td>
                                                            <td>
                                                                <?php if($User->canAccessQual($qID, 'STAFF')): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=unit&id=<?php echo $unit->getID() ?>&courseID=<?php echo $cID ?>&qualID=<?php echo $qID ?>&access=v" target="_blank"><?php echo $string['viewgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <td>
                                                                <?php if($User->canEditQual($qID)): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=unit&id=<?php echo $unit->getID() ?>&courseID=<?php echo $cID ?>&qualID=<?php echo $qID ?>&access=e" target="_blank"><?php echo $string['editgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <td>
                                                                <?php if($User->canEditQual($qID)): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=unit&id=<?php echo $unit->getID() ?>&courseID=<?php echo $cID ?>&qualID=<?php echo $qID ?>&access=ae" target="_blank"><?php echo $string['advancededitgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                        </tr>

                                                    <?php endforeach; ?>

                                                </table>

                                            <?php else: ?>

                                                <p class="gt_centre"><?php echo $string['qualnounits'] ?></p>

                                            <?php endif; ?>

                                            <br>

                                        <?php endforeach; ?>

                                    <?php endif; ?>

                                <?php endforeach; ?>








                            <?php elseif ($type == 'class'): ?>

                                <?php foreach($results as $cID => $quals): ?>

                                    <?php if ($cID > 0): ?>
                                        <h3 class="gt_form_heading"><?php echo \GT\Course::getNameById($cID) ?></h3>
                                    <?php endif; ?>

                                    <?php if ($quals): ?>

                                        <?php foreach($quals as $qID => $qual): ?>

                                            <h4 class="gt_form_heading <?php echo (!$User->isOnQual($qID, 'STAFF')) ? 'gt_no_access' : ''; ?>"><?php echo \GT\Qualification::getNameByID($qID) ?></h4>

                                                <table class="gt_filter_results">

                                                        <tr>
                                                            <td>
                                                                <?php if($User->canAccessQual($qID, 'STAFF')): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=class&id=<?php echo $qual->getID() ?>&courseID=<?php echo $cID ?>&access=v" target="_blank"><?php echo $string['viewgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <td>
                                                                <?php if($User->canEditQual($qID)): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=class&id=<?php echo $qual->getID() ?>&courseID=<?php echo $cID ?>&access=e" target="_blank"><?php echo $string['editgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <td>
                                                                <?php if($User->canEditQual($qID)): ?>
                                                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=class&id=<?php echo $qual->getID() ?>&courseID=<?php echo $cID ?>&access=ae" target="_blank"><?php echo $string['advancededitgrid'] ?></a>
                                                                <?php endif; ?>
                                                            </td>
                                                            <?php if ($qual->getAssessments()): ?>
                                                                <td>
                                                                    <?php if($User->canAccessQual($qID, 'STAFF')): ?>
                                                                        <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=class&id=<?php echo $qual->getID() ?>&courseID=<?php echo $cID ?>&ass=1" target="_blank"><?php echo $string['assessmentgrid'] ?></a>
                                                                    <?php endif; ?>
                                                                </td>
                                                            <?php endif; ?>
                                                        </tr>

                                                </table>

                                            <br>

                                        <?php endforeach; ?>

                                    <?php endif; ?>

                                <?php endforeach; ?>

                            <?php endif; ?>

                    <?php elseif (isset($results)): ?>

                        <p class="gt_c"><?php echo $string['noresults'] ?></p>

                    <?php endif; ?>

                </div>

            </div>

            <br class="gt_cl"><br>

        </div>


    </div>

</div>