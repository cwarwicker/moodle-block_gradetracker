<?php if(!defined('BCGT')) exit; ?>

<?php echo (!empty($MSGS['errors'])) ? gt_error_alert_box($MSGS['errors']) : '' ?>
<?php echo (!empty($MSGS['success'])) ? gt_success_alert_box($MSGS['success']) : '' ?>

<div class='gt_c'>
    <a href='config.php?view=structures&section=builds&page=new'><input type='button' class='gt_btn' value='<?php echo $string['addnewbuild'] ?>' /></a>
    &nbsp;&nbsp;&nbsp;&nbsp;
    <div id='gt_import_div'><a href='#' class='gt_btn gt_toggle' toggle='#gt_upload_div'><?php echo $string['importnewstructure'] ?></a></div>
    <div id='gt_upload_div' style='display:none;'>
        <br>
        <form action="" method="post" enctype="multipart/form-data">
            <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />
            <input type="file" name="file" accept="text/xml,application/zip" /><br>
            <small><b><?php echo $string['createlevelsubtype'] ?></b></small>: <input type="checkbox" name="create" value="1" /><br>
            <small><b><?php echo $string['updatebuildimport'] ?></b></small>:
                <input type="radio" name="update_method" value="" checked /> <small><?php echo $string['skip'] ?></small>
                &nbsp;&nbsp;&nbsp;
                <input type="radio" name="update_method" value="overwrite" /> <small><?php echo $string['overwrite'] ?></small>
                &nbsp;&nbsp;&nbsp;
                <input type="radio" name="update_method" value="merge" /> <small><?php echo $string['merge'] ?></small>
            <br>
            <input type="submit" name="import_qual_build" class="gt_btn_small gt_blue" value="<?php echo $string['upload'] ?>" />
        </form>
    </div>
</div>

<br>
<?php if (!empty($MSGS['import_output'])): ?>
    <div id='gt_import_output' class='gt_cmd'>
        <?php echo $MSGS['import_output'] ?>
    </div>
    <br>
<?php endif; ?>
<br>

<div>

    <?php if ($builds): ?>

        <table class="gt_config" style="width:inherit;">

          <thead>
            <tr>
              <th colspan="7"><?php echo $string['qualbuilds'] ?></th>
            </tr>
            <tr>
                <th><?php echo $string['type'] ?></th>
                <th><?php echo $string['level'] ?></th>
                <th><?php echo $string['subtype'] ?></th>
                <th><?php echo $string['qualawards'] ?></th>
                <th><?php echo $string['assessmentawards'] ?></th>
                <th><?php echo $string['defaults'] ?></th>
                <th></th>
            </tr>
          </thead>
          <tbody>
            <?php foreach($builds as $build): ?>

                <tr>
                    <td><?php echo $build->getStructureRealName() ?></td>
                    <td><?php echo $build->getLevelName() ?></td>
                    <td><?php echo $build->getSubTypeName() ?></td>
                    <td>
                        <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=structures&section=builds&page=awards&id=<?php echo $build->getID() ?>"><img src="<?php echo gt_image_url('i/grades') ?>" alt="grades" /></a>
                        <?php if (!$build->getAwards()): ?>
                            <br><small style="color:red;">(!)</small>
                        <?php endif; ?>
                    </td>
                    <td>
                        <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=structures&section=grade&page=edit&type=criteria&build=<?php echo $build->getID() ?>">
                            <img src="<?php echo gt_image_url('i/grades') ?>" alt="grades" />
                        </a>
                    </td>
                    <td>
                        <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=structures&section=builds&page=defaults&id=<?php echo $build->getID() ?>">
                            <img src="<?php echo gt_image_url('i/report') ?>" alt="defaults" />
                        </a>
                    </td>
                    <td>
                        <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=structures&section=builds&page=delete&id=<?php echo $build->getID() ?>">
                            <img src="<?php echo gt_image_url('t/delete') ?>" alt="delete" />
                        </a>
                    </td>
                </tr>

            <?php endforeach; ?>
          </tbody>
        </table>

    <?php else: ?>

        <p class='gt_c'><?php echo $string['nodata'] ?></p>

    <?php endif; ?>

    <div>
        <p><br></p>
        <p><small><?php echo get_string('qualstructuresdatabase', 'block_gradetracker') ?></small></p>
    </div>

</div>

