<?php if(!defined('BCGT')) exit; ?>

<input type="hidden" id="gt-qID" value="<?php echo $Qualification->getID() ?>" />
<input type="hidden" id="gt-crID" value="<?php echo $courseID ?>" />
<input type="hidden" id="gt-groupID" value="<?php echo $groupID ?>" />
<input type="hidden" id="gt-access" value="<?php echo $access ?>" />
<input type="hidden" id="gt-page" value="<?php echo $page ?>" />
<input type="hidden" id="gt-assessmentView" value="<?php echo $assessmentView ?>" />

<div class='gt_full_page gt_grid'>

    <div class="gt_c">

            <?php if (!isset($print)): ?>

            <ul class="slimmenu">

                <li class="gt_nav_dropdowns">

                    <select class="gt_switch_course">
                        <option value=""><?php echo $string['switchcourse'] ?></option>
                        <?php if ($Qualification->getCourses()): ?>
                            <?php foreach($Qualification->getCourses() as $qualCourse): ?>
                                <option value="<?php echo $qualCourse->id ?>" <?php echo (isset($Course) && $qualCourse->id == $Course->id) ? 'selected' : ''; ?> ><?php echo $qualCourse->getName() ?></option>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </select>

                    <select class="gt_switch_group">
                        <option value=""><?php echo $string['switchgroup'] ?></option>
                        <?php if (isset($Course) && ($groups = $Course->getGroups())): ?>
                            <?php if ($groups['parent']): ?>
                                <?php foreach($groups['parent'] as $pID => $parentGroups): ?>
                                    <optgroup label="<?php echo \block_gradetracker\Course::getNameById($pID) ?>">
                                        <?php foreach($parentGroups as $group): ?>
                                            <option value="<?php echo $group->id ?>" <?php echo ($groupID == $group->id) ? 'selected' : '' ?> ><?php echo $group->name ?> (<?php echo $group->usercnt ?>)</option>
                                        <?php endforeach; ?>
                                    </optgroup>
                                <?php endforeach; ?>
                            <?php endif; ?>

                            <?php if ($groups['direct']): ?>
                                <optgroup label="<?php echo $Course->getName() ?>">
                                    <?php foreach($groups['direct'] as $group): ?>
                                        <option value="<?php echo $group->id ?>" <?php echo ($groupID == $group->id) ? 'selected' : '' ?> ><?php echo $group->name ?> (<?php echo $group->usercnt ?>)</option>
                                    <?php endforeach; ?>
                                </optgroup>
                            <?php endif; ?>

                            <?php if ($groups['child']): ?>
                                <?php foreach($groups['child'] as $cID => $childGroups): ?>
                                    <optgroup label="<?php echo \block_gradetracker\Course::getNameById($cID) ?>">
                                        <?php foreach($childGroups as $group): ?>
                                            <option value="<?php echo $group->id ?>" <?php echo ($groupID == $group->id) ? 'selected' : '' ?> ><?php echo $group->name ?> (<?php echo $group->usercnt ?>)</option>
                                        <?php endforeach; ?>
                                    </optgroup>
                                <?php endforeach; ?>
                            <?php endif; ?>

                        <?php endif; ?>
                    </select>

                </li>

                <li>

                    <a href="#"><?php echo $string['grid'] ?></a>
                    <ul>
                        <li>
                            <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/print.php?type=class&id=<?php echo $Qualification->getID() ?>&courseID=<?php echo $courseID ?><?php echo (isset($assessmentView) && $assessmentView) ? '&ass=1' : ''; ?>&groupID=<?php echo $groupID ?>"><?php echo $string['printgrid'] ?></a>
                        </li>
                        <li>
                            <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/export.php?type=datasheet&grid=class&qualID=<?php echo $Qualification->getID() ?>&courseID=<?php echo $courseID ?>&groupID=<?php echo $groupID ?><?php echo (isset($assessmentView) && $assessmentView) ? '&ass=1' : ''; ?>&sesskey=<?php echo sesskey() ?>"><?php echo $string['exportdatasheet'] ?></a>
                        </li>
                        <li>
                            <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/import.php?type=datasheet&grid=class&qualID=<?php echo $Qualification->getID() ?><?php echo (isset($assessmentView) && $assessmentView) ? '&ass=1' : ''; ?>"><?php echo $string['importdatasheet'] ?></a>
                        </li>
                    </ul>

                </li>

                <li>
                    <a href="#"><?php echo $string['context'] ?></a>
                    <ul>
                        <?php if ($User->hasCapability('block/gradetracker:configure_quals')): ?>
                            <li>
                                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=quals&section=edit&id=<?php echo $Qualification->getID() ?>"><?php echo $string['editqualification'] ?></a>
                            </li>
                        <?php endif; ?>

                        <?php if ( $courseID > 0 && ($User->isOnCourse($courseID, "STAFF") || $User->hasCapability('block/gradetracker:edit_all_courses')) ): ?>
                            <li>
                                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=course&section=userquals&id=<?php echo $courseID ?>"><?php echo $string['userquals'] ?></a>
                            </li>
                            <li>
                                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/config.php?view=course&section=userunits&id=<?php echo $courseID ?>"><?php echo $string['userunits'] ?></a>
                            </li>
                        <?php endif; ?>
                    </ul>
                </li>

                <li>
                    <a href="#"><?php echo $string['core'] ?></a>
                    <ul>
                        <li>
                            <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/dashboard.php"><?php echo $string['mydashboard'] ?></a>
                        </li>

                        <?php if ($User->hasCapability('block/gradetracker:view_student_grids')): ?>
                            <li>
                                <?php if ($courseID > 0): ?>
                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/choose.php?type=student&myCourseID=<?php echo $courseID ?>"><?php echo $string['studentgrids'] ?></a>
                                <?php else: ?>
                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/choose.php?type=student"><?php echo $string['studentgrids'] ?></a>
                                <?php endif; ?>
                            </li>
                        <?php endif; ?>

                        <?php if ($User->hasCapability('block/gradetracker:view_unit_grids')): ?>
                            <li>
                                <?php if ($courseID > 0): ?>
                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/choose.php?type=unit&myCourseID=<?php echo $courseID ?>"><?php echo $string['unitgrids'] ?></a>
                                <?php else: ?>
                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/choose.php?type=unit"><?php echo $string['unitgrids'] ?></a>
                                <?php endif; ?>
                            </li>
                        <?php endif; ?>

                        <?php if ($User->hasCapability('block/gradetracker:view_class_grids')): ?>
                            <li>
                                <?php if ($courseID > 0): ?>
                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/choose.php?type=class&myCourseID=<?php echo $courseID ?>"><?php echo $string['classgrids'] ?></a>
                                <?php else: ?>
                                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/choose.php?type=class"><?php echo $string['classgrids'] ?></a>
                                <?php endif; ?>
                            </li>
                        <?php endif; ?>

                    </ul>
                </li>


                <?php if ($links): ?>

                    <?php foreach($links as $link): ?>

                    <li>
                        <a href="<?php echo (strlen($link->url)) ? $Qualification->parseURL($link->url) : '#' ?>" target="_blank"><?php echo \gt_html($link->name) ?></a>
                        <?php if ($link->sub): ?>
                        <ul>
                            <?php foreach($link->sub as $sub): ?>
                                <li>
                                    <a href="<?php echo (strlen($sub->url)) ? $Qualification->parseURL($sub->url) : '#' ?>" target="_blank"><?php echo \gt_html($sub->name) ?></a>
                                </li>
                            <?php endforeach; ?>
                        </ul>
                        <?php endif; ?>
                    </li>

                    <?php endforeach; ?>

                <?php endif; ?>

            </ul>
        <br>
        <?php endif; ?>

        <?php if(isset($Course)): ?>
            <h2 class="gt_h2">
                <?php echo $Course->getName() ?>
                <?php if(isset($Group)): ?>
                  :: <?php echo $Group->name ?>
                <?php endif; ?>
            </h2>
        <?php endif; ?>

        <h1 class="gt_h1"><?php echo $Qualification->getDisplayName() ?></h1>
        <br>


        <?php if ($assessmentView && $hasWeightings && \gt_has_capability('block/gradetracker:see_coefficient_table')): ?>

            <table class='gt_coefficient_table'>
                <tr>
                    <th colspan="<?php echo $weightingPercentiles + 2 ?>"><?php echo $string['weightingcoefficients'] ?></th>
                </tr>
                <tr>
                    <th><?php echo $string['qualification'] ?></th>
                    <?php for ($i = 1; $i <= $weightingPercentiles; $i++): ?>
                        <th style="background-color:<?php echo \block_gradetracker\Setting::getSetting('weighting_percentile_color_'.$i) ?>;"><?php echo $i ?></th>
                    <?php endfor; ?>
                </tr>
                <tr>
                    <td class='gt_qual_name'><?php echo $Qualification->getDisplayName() ?></td>
                    <?php for ($i = 1; $i <= $weightingPercentiles; $i++): ?>
                        <td style="background-color:<?php echo \block_gradetracker\Setting::getSetting('weighting_percentile_color_'.$i) ?>;"><?php echo $Qualification->getAttribute('coefficient_'.$i) ?></td>
                    <?php endfor; ?>
                </tr>
            </table>
            <br>

        <?php endif; ?>


        <?php if (!isset($print)): ?>
            <p>
                <input type="button" class="gt_load_grid gt_btn" grid="class" access="v" value="<?php echo $string['view'] ?>" />
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input id="gt_edit_button" type="button" class="gt_load_grid gt_btn" grid="class" access="e" style="display:<?php echo ($access == 'e') ? 'none' : 'initial' ?>;" value="<?php echo $string['edit'] ?>" />
                <input id="gt_adv_edit_button" type="button" class="gt_load_grid gt_btn" grid="class" access="ae" style="display:<?php echo ($access == 'e') ? 'initial' : 'none' ?>;" value="<?php echo $string['advancededit'] ?>" />
                <?php if ($Qualification->getAssessments() && $gridFile != 'assessment_grid'): ?>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <a class="gt_btn gt_pink" href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=class&id=<?php echo $Qualification->getID() ?>&access=<?php echo $access ?>&courseID=<?php echo $courseID ?>&ass=1"><?php echo $string['assessmentgrid'] ?></a>
                <?php elseif ($Qualification->getAssessments() && $gridFile == 'assessment_grid' && $Qualification->isLevelEnabled('units')): ?>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <a class="gt_btn gt_pink" href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=class&id=<?php echo $Qualification->getID() ?>&access=<?php echo $access ?>&courseID=<?php echo $courseID ?>"><?php echo $string['normalgrid'] ?></a>
                <?php endif; ?>
            </p>
            <br>
        <?php endif; ?>


    </div>

    <?php if (!isset($print)): ?>

        <p id="gt_loading" class="gt_hidden"><img src="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/pix/ajax-loader.gif" alt="<?php echo $string['loading'] ?>" /></p>

        <?php \gt_display_debug_section() ?>

        <?php if ($GT->getSetting('grid_fixed_links') == 1): ?>
            <div id="gt_grid_quick_links">
                <a href="#" class="gt_load_grid" grid="class" access="v" title="<?php echo $string['redraw'] ?>"><img src="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/pix/icons/arrow_refresh.png" class="gt_icon" alt="<?php echo $string['redraw'] ?>" /></a><br>
                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/print.php?type=class&id=<?php echo $Qualification->getID() ?>&courseID=<?php echo $courseID ?>&groupID=<?php echo $groupID ?>" title="<?php echo $string['printgrid'] ?>"><img src="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/pix/icons/printer.png" class="gt_icon" alt="<?php echo $string['printgrid'] ?>" /></a><br>
                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/export.php?type=datasheet&grid=class&qualID=<?php echo $Qualification->getID() ?>&courseID=<?php echo $courseID ?>&groupID=<?php echo $groupID ?>&sesskey=<?php echo sesskey() ?>" title="<?php echo $string['exportdatasheet'] ?>"><img src="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/pix/icons/excel_exports.png" class="gt_icon" alt="<?php echo $string['exportdatasheet'] ?>" /></a><br>
                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/import.php?type=datasheet&grid=class&qualID=<?php echo $Qualification->getID() ?>&courseID=<?php echo $courseID ?>&groupID=<?php echo $groupID ?>" title="<?php echo $string['importdatasheet'] ?>"><img src="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/pix/icons/excel_imports.png" class="gt_icon" alt="<?php echo $string['importdatasheet'] ?>" /></a>
            </div>
        <?php endif; ?>

    <?php endif; ?>


    <?php if (!isset($print) && isset($reqPages) && $reqPages > 1): ?>

        <div class="gt_pagination">
            <?php for($i = 1; $i <= $reqPages; $i++): ?>
                <a class="gt_change_grid_page gt_pagenumber gt_pagenumber_<?php echo $i ?> <?php echo ($page == $i) ? 'active' : '' ?>" page="<?php echo $i ?>" href="#"><?php echo $i ?></a>
            <?php endfor; ?>
        </div>

    <?php endif; ?>

    <div id="gt_grid_holder">
        <?php if (isset($print)): ?>
            <?php include $CFG->dirroot . '/blocks/gradetracker/tpl/grids/class/'.$gridFile.'.html' ?>
        <?php endif; ?>
    </div>


</div>