<?php if(!defined('BCGT')) exit; ?>

<table id="gt_class_grid" class="gt_class_grid" style="width:95%;">

    <?php $cnt = count($studentCols) + 2; ?>
    <tr>

        <?php if ($studentCols): ?>
            <?php foreach($studentCols as $col): ?>
                <th class="gt_grid_user_<?php echo $col ?> gt_grid_freeze_col"><?php echo ($col != 'pic') ? get_string($col) : '' ?></th>
            <?php endforeach; ?>
        <?php endif; ?>

        <th class="gt_grid_qual_award gt_grid_freeze_col"><?php echo $string['qualaward'] ?></th>

        <?php if ($Qualification->getUnits()): ?>

            <?php foreach($Qualification->getUnits() as $unit): ?>

                <th>
                    <?php if( \gt_has_capability('block/gradetracker:view_student_grids') && !isset($print) ): ?>
                    <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=unit&id=<?php echo $unit->getID() ?>&qualID=<?php echo $Qualification->getID() ?>&access=<?php echo $params['access'] ?>" target="_blank"><?php echo $unit->getShortenedDisplayName() ?></a>
                    <?php else: ?>
                        <?php echo $unit->getShortenedDisplayName() ?>
                    <?php endif; ?>
                </th>

            <?php endforeach; ?>

        <?php endif; ?>

    </tr>

    <?php if ($students): ?>

        <?php foreach($students as $student): ?>

            <?php $Qualification->loadStudent($student) ?>

            <tr>

                <?php if ($studentCols): ?>

                    <?php foreach($studentCols as $col): ?>

                        <td>
                            <?php if( \gt_has_capability('block/gradetracker:view_student_grids') && !isset($print) ): ?>
                                <a href="<?php echo $CFG->wwwroot ?>/blocks/gradetracker/grid.php?type=student&id=<?php echo $student->id ?>&qualID=<?php echo $Qualification->getID() ?>&access=<?php echo $params['access'] ?>" target="_blank"><?php echo $student->getProp($col) ?></a>
                            <?php else: ?>
                                <?php echo $student->getProp($col) ?>
                            <?php endif; ?>
                        </td>

                    <?php endforeach; ?>

                <?php endif; ?>

                <td class="gt_grid_qual_award qual_award_<?php echo $student->id ?>_<?php echo $Qualification->getID() ?>" sID="<?php echo $student->id ?>" qID="<?php echo $Qualification->getID() ?>">
                    <?php if ($qualAward = $student->getQualAward($Qualification->getID())): ?>
                        <?php echo $string[$qualAward[0]] ?><br>
                        <?php echo $qualAward[1]->getName() ?>
                    <?php else: ?>
                        <?php echo $string['na'] ?>
                    <?php endif; ?>
                </td>

                <?php if ($Qualification->getUnits()): ?>

                    <?php foreach($Qualification->getUnits() as $unit): ?>

                        <?php $unit->loadStudent( $student ) ?>

                        <?php if ($student->isOnQualUnit($Qualification->getID(), $unit->getID(), "STUDENT")): ?>
                            <td id="S<?php echo $student->id ?>_Q<?php echo $Qualification->getID() ?>_U<?php echo $unit->getID() ?>" qID="<?php echo $Qualification->getID() ?>" uID="<?php echo $unit->getID() ?>" sID="<?php echo $student->id ?>">
                                <?php echo $unit->getAwardCell( $params['access'] ); ?>
                            </td>
                        <?php else: ?>
                            <td id="S<?php echo $student->id ?>_Q<?php echo $Qualification->getID() ?>_U<?php echo $unit->getID() ?>" qID="<?php echo $Qualification->getID() ?>" uID="<?php echo $unit->getID() ?>" sID="<?php echo $student->id ?>" class="gt_cell_blank"></td>
                        <?php endif; ?>


                    <?php endforeach; ?>

                <?php endif; ?>



            </tr>

        <?php endforeach; ?>

    <?php else: ?>

        <tr>
            <td colspan="<?php echo $cnt ?>"><?php echo $string['nodata'] ?></td>
        </tr>

    <?php endif; ?>


</table>

